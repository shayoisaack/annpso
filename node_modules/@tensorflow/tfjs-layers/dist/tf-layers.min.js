/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@tensorflow/tfjs-core")):"function"==typeof define&&define.amd?define(["exports","@tensorflow/tfjs-core"],t):t(e.tf=e.tf||{},e.tf)}(this,function(e,P){"use strict";var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function l(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var k=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};function n(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(o=(a<3?r(o):3<a?r(t,n,o):r(t,n))||o);return 3<a&&o&&Object.defineProperty(t,n,o),o}function f(a,o,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{r(l.next(e))}catch(e){t(e)}}function i(e){try{r(l.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,i)}r((l=l.apply(a,o||[])).next())})}function C(n,i){var r,a,o,e,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(o=a[2&t[0]?"return":t[0]?"throw":"next"])&&!(o=o.call(a,t[1])).done)return o;switch(a=0,o&&(t=[0,o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],a=0}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var u=function(n){function i(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,i.prototype),t}return l(i,n),i}(Error),ae=function(n){function i(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,i.prototype),t}return l(i,n),i}(Error),oe=function(n){function i(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,i.prototype),t}return l(i,n),i}(Error),_=function(n){function i(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,i.prototype),t}return l(i,n),i}(Error),r=function(n){function i(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,i.prototype),t}return l(i,n),i}(Error);!function(n){function i(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,i.prototype),t}l(i,n)}(Error);function M(e,t){if(Array.isArray(e)){for(var n=[],i=0;i<t;i++)n=n.concat(e);return n}return(n=new Array(t)).fill(e),n}function se(e,t){if(!e)throw new r(t)}function a(e,t){for(var n=0,i=0,r=e;i<r.length;i++){r[i]===t&&n++}return n}function L(e){return 1===e.length?e[0]:e}function E(e){return Array.isArray(e)?e:[e]}function c(e){return Array.isArray(e)&&Array.isArray(e[0])}function A(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function d(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function g(e){return e.length<=1?e:-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var T={};function t(e){return null==e?null:{className:e.getClassName(),config:e.getConfig()}}function o(e,t,n,i){if(void 0===t&&(t={}),void 0===n&&(n={}),void 0===i&&(i="object"),"string"==typeof e){var r=e,a=void 0;if(r in n)a=n[r];else if(r in T)a=T[r];else if(null==(a=t[r]))throw new oe("Unknown "+i+": "+e);return a}var o=e;if(null==o.className||null==o.config)throw new oe(i+": Improper config format: "+JSON.stringify(o)+".\n'className' and 'config' must set.");var s=o.className,l=void 0,u=void 0;if(s in n?(l=(I=n.get(s))[0],u=I[1]):s in T?(l=(S=T.className)[0],u=S[1]):s in t&&(l=(N=t[s])[0],u=N[1]),null==l)throw new oe("Unknown "+i+": "+s);if(null!=u){for(var c={},h=0,p=Object.keys(T);h<p.length;h++){c[v=p[h]]=T[v]}for(var d=0,f=Object.keys(n);d<f.length;d++){c[v=f[d]]=n[v]}o.config.customObjects=c;for(var g=k({},T),m=0,y=Object.keys(n);m<y.length;m++){var v=y[m];T[v]=n[v]}var b=u(l,o.config);return T=k({},g),b}g=k({},T);for(var w=0,z=Object.keys(n);w<z.length;w++){v=z[w];T[v]=n[v]}var I,S,N;b=new l(o.config);return T=k({},g),b}function v(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new oe("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t}function h(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new oe("Expected exactly 1 Shape; got "+e.length)}return e}function le(e,t){return-1*((n=e)<(i=t)?-1:i<n?1:0);var n,i}function ue(e){if(null==e)return e;for(var t=[],n=0,i=e;n<i.length;n++){var r=i[n];-1===t.indexOf(r)&&t.push(r)}return t}function R(e){if(null==e)throw new oe("Invalid value in obj: "+JSON.stringify(e));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function p(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new oe(n+" is not a valid "+t+".  Valid values are "+e+" or null/undefined.")}var s=new Map,m=["channelsFirst","channelsLast"];function b(e){p(m,"DataFormat",e)}var y=["valid","same","causal"];function w(e){p(y,"PaddingMode",e)}var z=["max","avg"];var I=[],S="/";function N(e){if(!O(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===I.length?"":I.join(S)+S)+e}function D(e){if(!O(e))throw new Error("Not a valid tensor name: '"+e+"'");s.has(e)||s.set(e,0);var t=s.get(e);if(s.set(e,s.get(e)+1),0<t){var n=e+"_"+t;return s.set(n,1),n}return e}var F=new RegExp(/^[A-Za-z][A-Za-z0-9\._\/]*$/);function O(e){return!!e.match(F)}function x(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var i=1,r=t;r<n;++r)i*=e[r];return i}function B(e){return e=Array.isArray(e)?new Float32Array(e):e,P.tensor1d(e)}function U(e){return P.min(B(e)).dataSync()[0]}function j(e){return P.max(B(e)).dataSync()[0]}function W(e,t){if(t<e)throw new oe("end ("+t+") < begin ("+e+") is forbidden.");for(var n=[],i=e;i<t;++i)n.push(i);return n}var V=0;function q(){return V++}var Z=function(){function e(e,t,n,i,r,a,o){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=i,this.callArgs=r,this.outputTensorIndex=o,this.id=q(),null!=a&&(this.originalName=N(a),this.name=D(this.originalName)),this.rank=t.length}return e=n([P.doc({heading:"Models",subheading:"Classes"})],e)}(),K="Variable",H=function(){function e(e,t,n,i,r){void 0===t&&(t="float32"),void 0===n&&(n=K),void 0===i&&(i=!0),void 0===r&&(r=null),this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=q(),n=null==n?K:n,this.originalName=N(n),this.name=D(this.originalName),this.trainable=i,this.constraint=r,this.val=P.variable(e,this.trainable,this.name,this.dtype)}return e.prototype.read=function(){return this.val},e.prototype.write=function(e){return function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val)),this},e}();function G(e){return e.map(function(e){return e.read()})}function J(e){e.map(function(e){e[0].write(e[1])})}var X="float32",$={float32:{},int32:{}};function Y(e,t){return void 0===t&&(t=X),null==$[t][e]&&($[t][e]=P.scalar(e,t),P.keep($[t][e])),$[t][e]}var Q=function(){return 1e-7};function ee(e){return e.shape}function te(e){return e.shape}function ne(e){return e instanceof P.Tensor?X:e.dtype}function ie(e,t){return e.asType(t)}function re(e,t){void 0===t&&(t=-1);var n=ee(e).slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function ce(e,t,n){return P.tidy(function(){switch(e.rank){case 1:return P.slice1d(e,t,n);case 2:return P.slice2d(e,[t,0],[n,e.shape[1]]);case 3:return P.slice3d(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return P.slice4d(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);default:throw new oe("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}})}function he(e,t,n){return P.tidy(function(){switch(e.rank){case 1:return P.slice1d(e,t,n);case 2:return P.slice2d(e,[0,t],[e.shape[0],n]);case 3:return P.slice3d(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return P.slice4d(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new oe("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}})}function pe(e,t,n,i){return P.tidy(function(){switch(e.rank){case 1:return P.slice1d(e,t,n);case 2:switch(i){case 1:return ce(e,t,n);case 2:return he(e,t,n);default:throw new oe("The axis is not within the rank of the tensor "+i)}case 3:switch(i){case 1:return ce(e,t,n);case 2:return P.slice3d(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return he(e,t,n);default:throw new oe("The axis is not within the rank of the tensor "+i)}case 4:switch(i){case 1:return ce(e,t,n);case 2:return P.slice4d(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return P.slice4d(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return he(e,t,n);default:throw new oe("The axis is not within the rank of the tensor "+i)}default:throw new oe("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}})}function de(e,t){var n;return void 0===t&&(t=-1),t<0&&(t=0!==(n=e[0].rank)?n:0),t===e[0].rank&&(t=-1),P.concat(e,t)}function fe(e,t){switch(e.rank){case 1:return P.concat1d([e,t]);case 2:return P.concat2d([e,t],0);case 3:return P.concat3d([e,t],0);case 4:return P.concat4d([e,t],0);default:throw new oe("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}function ge(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new oe("The length of input n ("+t.length+") does not match the number of dimensions in input x ("+e.rank+")");return P.tile(e,t)}function me(e,t){return P.mul(e,t)}function ye(e,t){return P.add(e,t)}function ve(e,t,n,i,r){return void 0===t&&(t=0),void 0===n&&(n=1),P.randomNormal(e,t,n,i,r)}function be(e,t){if(2!==t.rank)throw new _("dot support for y other than rank 2 is not yet implemented: y shape = "+ee);if(2===e.rank)return P.matMul(e,t);if(3===e.rank){var n=e.shape[0],i=e.shape[1],r=e.shape[2];return e=e.reshape([n*i,r]),P.matMul(e,t).reshape([n,i,t.shape[1]])}throw new _("dot support for x of rank "+e.rank+" is not yet implemented: x shape = "+ee)}function we(e,t,n){return P.tidy(function(){return t=Array.isArray(t)?P.tensor1d(t,"int32"):t.toInt(),P.gather(e,t,n)})}function ze(e){return P.mulStrict(e,e)}function Ie(n,i,r){return P.tidy(function(){if(null==r&&(r="channelsLast"),b(r),1!==i.rank&&i.rank!==n.rank)throw new oe("Unexpected bias dimensions: "+i.rank+"; expected it to be 1 or "+n.rank);var e,t=i.shape;if(5===n.rank)"channelsFirst"===r?e=1===t.length?n.add(i.reshape([1,t[0],1,1,1])):n.add(i.reshape([1,t[3],t[0],t[1],t[2]])):"channelsLast"===r&&(e=1===t.length?n.add(i.reshape([1,1,1,1,t[0]])):n.add(i.reshape([1].concat(t))));else if(4===n.rank)"channelsFirst"===r?e=1===t.length?n.add(i.reshape([1,t[0],1,1])):n.add(i.reshape([1,t[2],t[0],t[1]])):"channelsLast"===r&&(e=1===t.length?n.add(i.reshape([1,1,1,t[0]])):n.add(i.reshape([1].concat(t))));else if(3===n.rank)"channelsFirst"===r?e=1===t.length?n.add(i.reshape([1,t[0],1])):n.add(i.reshape([1,t[1],t[0]])):"channelsLast"===r&&(e=1===t.length?n.add(i.reshape([1,1,t[0]])):n.add(i.reshape([1].concat(t))));else{if(!(n.rank<3))throw new oe("Unsupported input rank by biasAdd: "+n.rank);e=n.add(i)}return e})}function Se(e,t){return function(e,t){I.push(e);try{var n=t();return I.pop(),n}catch(e){throw I.pop(),e}}(e,t)}var Ne={};function ke(e){return void 0===e&&(e=""),e in Ne||(Ne[e]=0),Ne[e]+=1,e+Ne[e].toString()}function Ce(e,t){return P.tidy(function(){return P.sqrt(P.sum(ze(e),t,!0))})}var Le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.getConfig=function(){return{}},t=n([P.doc({heading:"Constraints",subheading:"Classes",namespace:"constraints"})],t)}(P.serialization.Serializable),Ae=function(n){function e(e){var t=n.call(this)||this;return t.defaultMaxValue=2,t.defaultAxis=0,t.maxValue=null!=e.maxValue?e.maxValue:t.defaultMaxValue,t.axis=null!=e.axis?e.axis:t.defaultAxis,t}return l(e,n),e.prototype.apply=function(n){var i=this;return P.tidy(function(){var e=Ce(n,i.axis),t=P.clipByValue(e,0,i.maxValue);return P.mul(n,P.div(t,ye(Y(Q()),e)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e.className="MaxNorm",e}(Le);P.serialization.SerializationMap.register(Ae);var Te=function(n){function e(e){var t=n.call(this)||this;return t.defaultAxis=0,t.axis=null!=e.axis?e.axis:t.defaultAxis,t}return l(e,n),e.prototype.apply=function(e){var t=this;return P.tidy(function(){return P.div(e,ye(Y(Q()),Ce(e,t.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e.className="UnitNorm",e}(Le);P.serialization.SerializationMap.register(Te);var Re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e){return P.relu(e)},t.className="NonNeg",t}(Le);P.serialization.SerializationMap.register(Re);var De=function(n){function e(e){var t=n.call(this)||this;return t.defaultMinValue=0,t.defaultMaxValue=1,t.defaultRate=1,t.defaultAxis=0,t.minValue=null!=e.minValue?e.minValue:t.defaultMinValue,t.maxValue=null!=e.maxValue?e.maxValue:t.defaultMaxValue,t.rate=null!=e.rate?e.rate:t.defaultRate,t.axis=null!=e.axis?e.axis:t.defaultAxis,t}return l(e,n),e.prototype.apply=function(n){var i=this;return P.tidy(function(){var e=Ce(n,i.axis),t=P.add(me(Y(i.rate),P.clipByValue(e,i.minValue,i.maxValue)),me(Y(1-i.rate),e));return P.mul(n,P.div(t,ye(Y(Q()),e)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e.className="MinMaxNorm",e}(Le);P.serialization.SerializationMap.register(De);var Fe={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Oe(e){return t(e)}function Me(e,t){return void 0===t&&(t={}),o(e,P.serialization.SerializationMap.getMap().classNameMap,t,"constraint")}function Ee(e){return null==e?null:"string"==typeof e?Me({className:e in Fe?Fe[e]:e,config:{}}):e instanceof Le?e:Me(e)}function xe(e,t){return void 0===t&&(t={}),o(e,P.serialization.SerializationMap.getMap().classNameMap,t,"layer")}function Pe(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}var _e=function(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}},Be=0,Ue=function(){function e(e,t){this.callArgs=t,this.id=Be++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(var n=0,i=e.inboundLayers;n<i.length;n++){var r=i[n];null!=r&&r.outboundNodes.push(this)}e.outboundLayer.inboundNodes.push(this)}return e.prototype.getConfig=function(){for(var e=[],t=0,n=this.inboundLayers;t<n.length;t++){var i=n[t];null!=i?e.push(i.name):e.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},e}(),je=0,We=function(s){function e(e){var t=s.call(this)||this;t._callHook=null,t._addedWeightNames=[],t._stateful=!1,t.id=je++,t.activityRegularizer=null,t.inputSpec=null,t.supportsMasking=!1,t._trainableWeights=[],t._nonTrainableWeights=[],t._losses=[],t._updates=[],t._built=!1,t.inboundNodes=[],t.outboundNodes=[];var n=e.name;if(!n){var i=t.getClassName();n=d(i)+"_"+ke(i)}if(t.name=n,t.trainable=null==e.trainable||e.trainable,t.updatable=null==e.updatable||e.updatable,null!=e.inputShape||null!=e.batchInputShape){var r=void 0;if(null!=e.batchInputShape)r=e.batchInputShape;else if(null!=e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),r=[a].concat(e.inputShape)}t.batchInputShape=r;var o=e.dtype;null==o&&(o=e.inputDType),null==o&&(o="float32"),t.dtype=o}return null!=e.weights?t.initialWeights=e.weights:t.initialWeights=null,t}return l(e,s),e.nodeKey=function(e,t){return e.name+"_ib-"+t.toString()},e.prototype.getNodeAtIndex=function(e,t){if(0===this.inboundNodes.length)throw new ae("The layer has never been called and thus has no defined "+t+".");if(this.inboundNodes.length<=e)throw new oe("Asked to get "+t+" at node "+e+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[e]},e.prototype.getInputAt=function(e){return L(this.getNodeAtIndex(e,"input").inputTensors)},e.prototype.getOutputAt=function(e){return L(this.getNodeAtIndex(e,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(1<this.inboundNodes.length)throw new u("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new u("Layer "+this.name+" is not connected, no input to return.");return L(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new u("Layer "+this.name+" has no inbound nodes.");if(1<this.inboundNodes.length)throw new u("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return L(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(e){return e()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(e){this._built=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this._trainableWeights:[]},set:function(e){this._trainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._nonTrainableWeights:this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),e.prototype.assertInputCompatibility=function(e){if(e=E(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=E(this.inputSpec);if(e.length!==t.length)throw new oe("Layer "+this.name+" expects "+t.length+" inputs, but it received "+e.length+" input tensors. Input received: "+e);for(var n=0;n<e.length;n++){var i=e[n],r=t[n];if(null!=r){var a=i.rank;if(null!=r.ndim&&a!==r.ndim)throw new oe("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+r.ndim+", found ndim="+a);if(null!=r.maxNDim&&a>r.maxNDim)throw new oe("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+r.maxNDim+", found ndim="+a);if(null!=r.minNDim&&a<r.minNDim)throw new oe("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+r.minNDim+", found ndim="+a+".");if(null!=r.dtype&&ne(i)!==r.dtype){var o=ne(i);throw new oe("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+r.dtype+", found dtype="+o+".")}if(r.axes){var s=te(i);for(var l in r.axes){var u=Number(l),c=r.axes[l],h=0<=u?s[u]:s[s.length+u];if(null!=c&&-1===[c,null].indexOf(h))throw new oe("Input "+n+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+c+" but got shape "+s+".")}}if(null!=r.shape){s=te(i);for(var p=0;p<r.shape.length;++p){var d=r.shape[p],f=s[p];if(null!=d&&null!=f&&d!==f)throw new oe("Input "+n+" is incompatible with layer "+this.name+": expected shape="+r.shape+", found shape=${xShape}.")}}}}}},e.prototype.call=function(e,t){return e},e.prototype.invokeCallHook=function(e,t){null!=this._callHook&&this._callHook(e,t)},e.prototype.setCallHook=function(e){this._callHook=e},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(p,d){var f=this;d=d||{};for(var g=E(p),e=!0,t=0,n=g;t<n.length;t++){if(!(n[t]instanceof Z)){e=!1;break}}for(var m=!0,i=0,r=g;i<r.length;i++){if(r[i]instanceof Z){m=!1;break}}if(e===m)throw new oe("Arguments to apply() must be all SymbolicTensors or all Tensors");return Se(this.name,function(){if(!f.built){f.assertInputCompatibility(p);for(var e=[],t=0,n=E(p);t<n.length;t++){var i=n[t];e.push(te(i))}f.build(L(e)),f.built=!0,f.initialWeights&&f.setWeights(f.initialWeights)}if(f.assertInputCompatibility(p),m){for(var r=[],a=0,o=E(c=f.call(p,d));a<o.length;a++){var s=o[a];-1!==g.indexOf(s)&&(s=s.clone()),r.push(s)}if(c=L(r),null!=f.activityRegularizer)throw new _("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}var l=function(e){e=E(e);for(var t=[],n=0,i=e;n<i.length;n++){var r=i[n];t.push(te(r))}return L(t)}(p),u=f.computeOutputShape(l),c=void 0,h="float32";if(c=null!=u&&0<u.length&&Array.isArray(u[0])?u.map(function(e,t){return new Z(h,e,f,E(p),d,f.name,t)}):new Z(h,u,f,E(p),d,f.name),f.addInboundNode(p,c,null,null,l,u,d),null!=f.activityRegularizer)throw new _("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c})},e.prototype.build=function(e){this.built=!0},e.prototype.getWeights=function(e){return void 0===e&&(e=!1),G(e?this.trainableWeights:this.weights)},e.prototype.setWeights=function(s){var l=this;P.tidy(function(){var e=l.weights;if(e.length!==s.length)throw new oe('You called setWeights(weights) on layer "'+l.name+'" with a weight list of length '+s.length+", but the layer was expecting "+e.length+" weights. Provided weights: "+s+"...");if(0!==e.length){for(var t=[],n=G(e),i=0;i<n.length;++i){var r=n[i],a=e[i],o=s[i];if(!P.util.arraysEqual(r.shape,o.shape))throw new oe("Layer weight shape "+r.shape+" not compatible with provided weight shape "+o.shape);t.push([a,o])}J(t)}})},e.prototype.addWeight=function(e,t,n,i,r,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new oe("Duplicate weight name "+e+" for layer "+this.name);this._addedWeightNames.push(e),null==n&&(n="float32");var s=new H(i.apply(t,n),n,e,a,o);return null!=r&&this.addLoss(function(){return r.apply(s.read())}),null==a&&(a=!0),a?this._trainableWeights.push(s):this._nonTrainableWeights.push(s),s},e.prototype.addLoss=function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=E(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,e))},e.prototype.computeOutputShape=function(e){return e},e.prototype.computeMask=function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer "+this.name+" does not support masking,but was passed an inputMask.");t.forEach(function(e){if(null!=e)throw new TypeError("Layer "+n.name+" does not support masking,but was passed an inputMask.")})}return null}return t},e.prototype.addInboundNode=function(e,t,n,i,r,a,o){void 0===o&&(o=null);var s=E(e);t=E(t),n=E(n),i=E(i),r=A(r),a=A(a);for(var l=[],u=[],c=[],h=0,p=s;h<p.length;h++){var d=p[h];l.push(d.sourceLayer),u.push(d.nodeIndex),c.push(d.tensorIndex)}new Ue({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:c,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:i,inputShapes:r,outputShapes:a},o);for(var f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f},e.prototype.getConfig=function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e},n([P.doc({heading:"Models",subheading:"Classes"})],e.prototype,"apply",null),e=n([P.doc({heading:"Layers",subheading:"Classes",namespace:"layers"})],e)}(P.serialization.Serializable);var Ve=function(a){function e(e){var t=a.call(this,{dtype:e.dtype,name:null!=e.name?e.name:ke("input").toString()})||this;if(null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),t.trainable=!1,t.built=!0,t.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new oe("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var n=e.batchInputShape;if(null==n){if(null==e.inputShape)throw new oe("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new oe("Cannot specify batchSize if batchInputShape isspecified when creating an InputLayer.");var i=e.dtype||"float32";t.batchInputShape=n,t.dtype=i,t.inputSpec=[{shape:n}];var r=new Z(t.dtype,t.batchInputShape,t,[],{},t.name);return r.nodeIndex=0,r.tensorIndex=0,new Ue({outboundLayer:t,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]}),t}return l(e,a),e.prototype.apply=function(e,t){throw new oe("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e.className="InputLayer",e}(We);function qe(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new oe("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new Ve({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}P.serialization.SerializationMap.register(Ve);var Ze=function(ie){function re(e){var d=ie.call(this,{})||this;if(d.containerNodes=new Set,d.name=e.name,null==d.name){var t=d.getClassName().toLowerCase();d.name=ke(t)}if(d.supportsMasking=!1,d.trainable=!0,d.updatable=!0,Array.isArray(e.inputs)?d.inputs=e.inputs.slice():d.inputs=[e.inputs],Array.isArray(e.outputs)?d.outputs=e.outputs.slice():d.outputs=[e.outputs],ue(d.inputs).length!==d.inputs.length)throw new oe("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+d.inputs.map(function(e){return e.name}));ue(d.outputs).length!==d.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+d.outputs.map(function(e){return e.name})),d.inputLayers=[],d.inputLayersNodeIndices=[],d.inputLayersTensorIndices=[],d.outputLayers=[],d.outputLayersNodeIndices=[],d.outputLayersTensorIndices=[],d.layers=[];for(var n=0,i=d.outputs;n<i.length;n++){var r=(N=i[n]).sourceLayer,a=N.nodeIndex,o=N.tensorIndex;d.outputLayers.push(r),d.outputLayersNodeIndices.push(a),d.outputLayersTensorIndices.push(o)}for(var s=0,l=d.inputs;s<l.length;s++){r=(N=l[s]).sourceLayer,a=N.nodeIndex,o=N.tensorIndex;se(0===a,"input layer has >1 nodes"),se(0===o,"input layer has >1 tensors"),d.inputLayers.push(r),d.inputLayersNodeIndices.push(a),d.inputLayersTensorIndices.push(o)}d.inputNames=[],d.outputNames=[],d.feedInputShapes=[],d.feedInputNames=[],d.feedOutputNames=[];for(var u=0;u<d.inputLayers.length;u++){if(!((r=d.inputLayers[u])instanceof Ve))throw new TypeError("Input layers to a Model must be InputLayer objects. Received inputs: "+e.inputs+". Input "+u+" (0-based) originates from layer type "+r.getClassName()+".");d.inputNames.push(r.name),d.feedInputShapes.push(r.batchInputShape),d.feedInputNames.push(r.name)}for(var c=0,h=d.outputLayers;c<h.length;c++){r=h[c];d.outputNames.push(r.name)}d.internalInputShapes=d.inputs.map(function(e){return e.shape}),d.internalOutputShapes=d.outputs.map(function(e){return e.shape});for(var p={},f={},g={},m={},y={},v=[],b=function(e,t,n,i,r,a){null!=i&&null!=r&&null!=a||(i=e.sourceLayer,r=e.nodeIndex,a=e.tensorIndex);var o=i.inboundNodes[r];if(-1!==n.indexOf(o))throw new ae("The tensor "+e.name+' at layer "'+i.name+'" is part of a cycle.');if(-1===t.indexOf(o)){d.containerNodes.add(re.nodeKey(i,r)),i.id in y||(y[i.id]=Object.keys(y).length),-1===n.indexOf(o)&&n.push(o);for(var s=o.inboundLayers.length,l=0;l<s;l++){var u=o.inputTensors[l],c=o.inboundLayers[l],h=o.nodeIndices[l],p=o.tensorIndices[l];b(u,t,n,c,h,p)}for(t.push(o);0<=n.indexOf(o);)n.splice(n.indexOf(o),1);v.push(o)}},w=[],z=[],I=0,S=d.outputs;I<S.length;I++){var N=S[I];b(N,w,z)}for(var k=0,C=v.slice().reverse();k<C.length;k++){(f[(G=C[k]).id]=G).id in p||(p[G.id]=0);var L=p[G.id],A=null==g[G.outboundLayer.id]?0:g[G.outboundLayer.id];L=Math.max(L,A),g[G.outboundLayer.id]=L,m[G.outboundLayer.id]=G.outboundLayer,p[G.id]=L;for(u=0;u<G.inboundLayers.length;u++){var T=G.inboundLayers[u],R=(a=G.nodeIndices[u],T.inboundNodes[a]),D=null==p[R.id]?0:p[R.id];p[R.id]=Math.max(L+1,D),f[R.id]=R}}var F={};for(var O in p){(L=p[O])in F||(F[L]=[]),F[L].push(f[O])}var M={};for(var E in g){(L=g[E])in M||(M[L]=[]),M[L].push(m[E])}var x=Object.keys(M).map(function(e){return parseInt(e,10)}).sort(le);d.layers=[];for(var P=0,_=x;P<_.length;P++){var B=M[L=_[P]];B.sort(function(e,t){var n=y[e.id],i=y[t.id];return n<i?-1:i<n?1:0});for(var U=0,j=B;U<j.length;U++){r=j[U];d.layers.push(r)}}d.layersByDepth=M,x=Object.keys(F).map(function(e){return parseInt(e,10)}).sort(le);for(var W=d.inputs.slice(),V=[],q=0,Z=x;q<Z.length;q++)for(var K=0,H=F[L=Z[q]];K<H.length;K++){var G;if(null!=(r=(G=H[K]).outboundLayer)){for(var J=0,X=G.inputTensors;J<X.length;J++){N=X[J];if(-1===W.indexOf(N))throw new ae("Graph disconnected: cannot obtain value for tensor "+N+' at layer "'+r.name+'". The following previous layers were accessed without issue: '+V)}for(var $=0,Y=G.outputTensors;$<Y.length;$++){N=Y[$];W.push(N)}V.push(r.name)}}d.nodesByDepth=F;for(var Q=d.layers.map(function(e){return e.name}),ee=function(t){var e=Q.filter(function(e){return e===t}).length;if(1!==e)throw new ae('The name "'+t+'" is used '+e+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(Q))},te=0,ne=Q;te<ne.length;te++){ee(ne[te])}return d.outboundNodes=[],d.inboundNodes=[],new Ue({outboundLayer:d,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:d.inputs,outputTensors:d.outputs,inputMasks:d.inputs.map(function(e){return null}),outputMasks:d.outputs.map(function(e){return null}),inputShapes:d.inputs.map(function(e){return e.shape}),outputShapes:d.outputs.map(function(e){return e.shape})}),d.built=!0,d}return l(re,ie),Object.defineProperty(re.prototype,"trainableWeights",{get:function(){if(0<this._trainableWeights.length)throw new oe("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var e=[],t=0,n=this.layers;t<n.length;t++){var i=n[t];e=e.concat(i.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var i=n[t];e.push.apply(e,i.nonTrainableWeights)}if(!this.trainable){for(var r=[],a=0,o=this.layers;a<o.length;a++){i=o[a];r.push.apply(r,i.trainableWeights)}return r.concat(e)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),re.prototype.loadWeights=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),n?function(e,t){for(var n={},i=0,r=0,a=t;r<a.length;r++)for(var o=a[r],s=0,l=o.weights;s<l.length;s++){var u=l[s];if(null!=n[u.originalName])throw new oe("Duplicate weight name: "+u.originalName);n[u.originalName]=u,i++}var c=[];for(var h in e)c.push([n[h],e[h]]),delete n[h];var p=[];for(var d in n)p.push(d);if(0<p.length)throw new oe(p.length+" of "+i+" weights are not set: "+p);J(c)}(e,this.layers):function(e,t,n){void 0===n&&(n=!1);for(var i=e.keras_version,r=e.backend,a=t.map(function(e){return e.name}),o={},s=0,l=t;s<l.length;s++){var u=l[s];null!=u.name&&(null==o[u.name]&&(o[u.name]=[]),o[u.name].push(u))}for(var c=e.weights,h=[],p=0;p<a.length;++p){var d=a[p],f=c[d];null==f&&(f=[]);for(var g=[],m=0;m<f.length;++m){var y=f[m];g.push(new H((I=y.dtype,S=y.shape,N=y.value,void 0,k=function(e){switch(e){case"float32":return"float32";default:throw new oe("Invalid dtype: "+e)}}(I),P.Tensor.make(S,{values:0===S.length?N:P.util.flatten(N)},k))))}for(var v=0,b=o[d];v<b.length;v++){var u=b[v],w=u.weights;if((g=Ke(u,g,i,r)).length!==w.length){if(!n)throw new oe("Layer #"+p+' (named "'+u.name+'") expects '+w.length+" weight(s), but the saved weights have "+g.length+" element(s).");console.warn("Skipping loading of weights of layer "+u.name+" due to mismatch in number of weights: ("+g.length+" vs "+w.length+").")}for(var z=0;z<g.length;++z)!n||P.util.arraysEqual(w[z].shape,g[z].shape)?h.push([w[z],g[z].read()]):console.warn("Skipping loading of weights for layer "+u.name+" due to mismatch in shape ("+w[z].shape+" vs "+g[z].shape+")")}}var I,S,N,k;J(h)}(e,this.layers,t)},re.prototype.updatedConfig=function(){var e=this.getConfig();return{className:this.getClassName(),config:e,kerasVersion:"tfjs-layers 0.6.6",backend:"TensorFlow.js"}},re.prototype.toJSON=function(e,t){void 0===t&&(t=!0);var n=function e(t,n){if(null==t)return null;if("string"==typeof t)return d(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var i=[],r=t.length,a=0;a<r;++a){var o=t[a];Pe(n,a,o)?i.push(o):i.push(e(o,n))}return i}for(var s={},l=0,u=Object.keys(t);l<u.length;l++){var c=u[l],h=t[c],p=d(c);s[p]="name"!==c&&"className"!==c||"string"!=typeof h?e(h,c):h}return s}(this.updatedConfig());return t?JSON.stringify(n):n},re.prototype.call=function(t,n){var i=this;return P.tidy(function(){var e;return t=E(t),e="mask"in n?E(n.mask):M(null,t.length),i.runInternalGraph(t,e)[0]})},re.prototype.computeMask=function(t,n){var i=this;return P.tidy(function(){var e;return t=E(t),e=null==n?M(null,t.length):E(n),i.runInternalGraph(t,e)[1]})},re.prototype.computeOutputShape=function(e){var t=A(e);if(t.length!==this.inputLayers.length)throw new oe("Invalid inputShape argument "+e+": model has "+this.inputLayers.length+" tensor inputs.");for(var n={},i=0;i<t.length;i++){var r=this.inputLayers[i],a=t[i];n[S=r.name+"_0_0"]=a}var o=Object.keys(this.nodesByDepth).map(function(e){return parseInt(e,10)}).sort(le);if(1<o.length)for(var s=0,l=o;s<l.length;s++)for(var u=l[s],c=0,h=this.nodesByDepth[u];c<h.length;c++){var p=h[c];r=p.outboundLayer;if(-1===this.inputLayers.map(function(e){return e.id}).indexOf(r.id)){for(var d=[],f=0;f<p.inboundLayers.length;f++){var g=p.inboundLayers[f],m=p.nodeIndices[f],y=p.tensorIndices[f],v=n[S=g.name+"_"+m+"_"+y];d.push(v)}var b=A(r.computeOutputShape(L(d))),w=r.inboundNodes.indexOf(p);for(f=0;f<b.length;f++){n[S=r.name+"_"+w+"_"+f]=b[f]}}}var z=[],I=[];for(i=0;i<this.outputLayers.length;i++){r=this.outputLayers[i],w=this.outputLayersNodeIndices[i],y=this.outputLayersTensorIndices[i];var S=r.name+"_"+w+"_"+y;I.push(S)}for(i=0;i<I.length;i++){var N=I[i];se(N in n),z.push(n[N])}return L(z)},re.prototype.runInternalGraph=function(e,t){null==t&&(t=M(null,e.length));for(var n={},i=0;i<this.inputs.length;++i){var r=this.inputs[i],a=e[i],o=t[i];n[r.id]=[a,o]}for(var s=0,l=Object.keys(this.nodesByDepth).map(function(e){return parseInt(e,10)}).sort(le);s<l.length;s++)for(var u=l[s],c=0,h=this.nodesByDepth[u];c<h.length;c++){for(var p=h[c],d=p.outboundLayer,f=p.inputTensors,g=p.outputTensors,m=new Array,y=0,v=f;y<v.length;y++){(r=v[y]).id in n&&m.push(n[r.id])}if(m.length===f.length){var b={},w=void 0,z=void 0,I=void 0,S=void 0;if(null!=p.callArgs&&(b=p.callArgs),1===m.length){var N=m[0],k=N[0],C=N[1];null==b.mask&&(b.mask=C),I=E(d.call(k,b)),S=E(d.computeMask(k,C)),w=[k],z=[C]}else w=m.map(function(e){return e[0]}),z=m.map(function(e){return e[1]}),null==b.mask&&(b.mask=z),I=E(d.call(w,b)),S=E(d.computeMask(w,z));if(d.activityRegularizer)throw new _("Model invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(i=0;i<g.length;++i){r=g[i],a=I[i],o=S[i];n[r.id]=[a,o]}}}for(var L=[],A=[],T=[],R=0,D=this.outputs;R<D.length;R++){se((r=D[R]).id in n,"Could not compute output "+r.name+" : "+r.id);var F=n[r.id],O=F[0];o=F[1];T.push(O.shape),L.push(O),A.push(o)}return[L,A,T]},re.prototype.buildNodeConversionMap=function(e){for(var t,n={},i=0,r=this.layers;i<r.length;i++){var a=r[i];t=a instanceof re?1:0;for(var o=0;o<a.inboundNodes.length;o++){var s=re.nodeKey(a,o);s in this.containerNodes&&(n[s]=t,t+=1)}}return n},re.prototype.getLayer=function(e,t){if(null!=t){if(this.layers.length<=t)throw new oe("Was asked to retrieve layer at index "+t+", but model only has "+this.layers.length+" layer(s).");return this.layers[t]}if(null==e)throw new oe("Provide either a layer name or layer index");for(var n=0,i=this.layers;n<i.length;n++){var r=i[n];if(r.name===e)return r}throw new oe("No such layer: "+e)},re.prototype.calculateLosses=function(){var o=this;return P.tidy(function(){for(var e=[],t=0,n=o.layers;t<n.length;t++)for(var i=n[t],r=0;r<i.inboundNodes.length;++r){var a=re.nodeKey(i,r);o.containerNodes.has(a)&&e.push.apply(e,i.calculateLosses())}return e})},re.prototype.getConfig=function(){for(var e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[],i=0,r=this.layers;i<r.length;i++){for(var a=(v=r[i]).getClassName(),o=v.getConfig(),s=[],l=0;l<v.inboundNodes.length;l++){var u=v.inboundNodes[l],c=re.nodeKey(v,l),h={};if(this.containerNodes.has(c)){if(u.callArgs)-1===JSON.stringify(u.callArgs).indexOf("undefined")?h=u.callArgs:(console.warn("Layer "+v.name+" was passed non-serializable keyword arguments: "+u.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),h={});if(0<u.inboundLayers.length){for(var p=[],d=0;d<u.inboundLayers.length;d++){var f=u.inboundLayers[d],g=u.nodeIndices[d],m=u.tensorIndices[d];null==(w=t[re.nodeKey(f,g)])&&(w=0),p.push([f.name,w,m,h])}s.push(p)}}}n.push({name:v.name,className:a,config:o,inboundNodes:s})}e.layers=n;var y=[];for(d=0;d<this.inputLayers.length;d++){var v=this.inputLayers[d];g=this.inputLayersNodeIndices[d],c=re.nodeKey(v,g);if(this.containerNodes.has(c)){null==(w=t[c])&&(w=0);m=this.inputLayersTensorIndices[d];y.push([v.name,w,m])}}e.inputLayers=y;var b=[];for(d=0;d<this.outputLayers.length;d++){v=this.outputLayers[d],g=this.outputLayersNodeIndices[d],c=re.nodeKey(v,g);if(this.containerNodes.has(c)){var w;null==(w=t[c])&&(w=0);m=this.outputLayersTensorIndices[d];b.push([v.name,w,m])}}return e.outputLayers=b,e},re.fromConfig=function(e,o){var p={},n={};function d(e,t){e.name in n?n[e.name].push(t):n[e.name]=[t]}function t(e,t){for(var n,i=[],r=0,a=t;r<a.length;r++){var o=a[r],s=o[0],l=o[1],u=o[2];if(3===o.length)n={};else{if(4!==o.length)throw new oe("Improperly formatted model config for layer "+JSON.stringify(e)+": "+JSON.stringify(o));n=o[3]}if(!(s in p))return void d(e,t);var c=p[s];if(c.inboundNodes.length<=l)return void d(e,t);var h=c.inboundNodes[l];i.push(h.outputTensors[u])}0<i.length&&e.apply(L(i),n)}function i(e){var t=e.name,n=xe(e,null!=o.customObjects?o.customObjects:{});p[t]=n;for(var i=0,r=e.inboundNodes;i<r.length;i++){var a=r[i];if(!(a instanceof Array))throw new oe("Corrupted configuration, expected array for nodeData: "+a);d(n,a)}}for(var r=o.name,a=o.layers,s=0,l=a;s<l.length;s++){i(h=l[s])}for(;!R(n);)for(var u=0,c=a;u<c.length;u++){var h=c[u];if((C=p[h.name]).name in n){for(var f=0,g=n[C.name];f<g.length;f++){t(C,g[f])}delete n[C.name]}}for(var m=[],y=[],v=0,b=o.inputLayers;v<b.length;v++){var w=(h=b[v])[0],z=h[1],I=h[2];se(w in p);var S=(C=p[w]).inboundNodes[z].outputTensors;m.push(S[I])}for(var N=0,k=o.outputLayers;N<k.length;N++){w=(h=k[N])[0],z=h[1],I=h[2];se(w in p);var C;S=(C=p[w]).inboundNodes[z].outputTensors;y.push(S[I])}return new e({inputs:m,outputs:y,name:r})},Object.defineProperty(re.prototype,"stateful",{get:function(){if(this._stateful)throw new oe("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var e=0,t=this.layers;e<t.length;e++){if(t[e].stateful)return!0}return!1},enumerable:!0,configurable:!0}),n([P.doc({heading:"Layers",subheading:"Classes",namespace:"layers",subclasses:["Model"]})],re.prototype,"getLayer",null),re}(We);function Ke(e,t,n,i){if(!n.startsWith("2."))throw new oe("Unsupported Keras version in weights being loaded: "+n);return t}var He=function(){function e(){this.validationData=null,this.model=null}return e.prototype.setParams=function(e){this.params=e},e.prototype.setModel=function(e){this.model=e},e.prototype.onEpochBegin=function(e,t){return f(this,void 0,void 0,function(){return C(this,function(e){return[2]})})},e.prototype.onEpochEnd=function(e,t){return f(this,void 0,void 0,function(){return C(this,function(e){return[2]})})},e.prototype.onBatchBegin=function(e,t){return f(this,void 0,void 0,function(){return C(this,function(e){return[2]})})},e.prototype.onBatchEnd=function(e,t){return f(this,void 0,void 0,function(){return C(this,function(e){return[2]})})},e.prototype.onTrainBegin=function(e){return f(this,void 0,void 0,function(){return C(this,function(e){return[2]})})},e.prototype.onTrainEnd=function(e){return f(this,void 0,void 0,function(){return C(this,function(e){return[2]})})},e}(),Ge=function(){function e(e,t){void 0===t&&(t=10),null==e&&(e=[]),this.callbacks=e,this.queueLength=t}return e.prototype.append=function(e){this.callbacks.push(e)},e.prototype.setParams=function(e){for(var t=0,n=this.callbacks;t<n.length;t++){n[t].setParams(e)}},e.prototype.setModel=function(e){for(var t=0,n=this.callbacks;t<n.length;t++){n[t].setModel(e)}},e.prototype.onEpochBegin=function(i,r){return f(this,void 0,void 0,function(){var t,n;return C(this,function(e){switch(e.label){case 0:null==r&&(r={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onEpochBegin(i,r)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onEpochEnd=function(i,r){return f(this,void 0,void 0,function(){var t,n;return C(this,function(e){switch(e.label){case 0:null==r&&(r={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onEpochEnd(i,r)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onBatchBegin=function(i,r){return f(this,void 0,void 0,function(){var t,n;return C(this,function(e){switch(e.label){case 0:null==r&&(r={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onBatchBegin(i,r)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onBatchEnd=function(i,r){return f(this,void 0,void 0,function(){var t,n;return C(this,function(e){switch(e.label){case 0:null==r&&(r={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onBatchEnd(i,r)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onTrainBegin=function(i){return f(this,void 0,void 0,function(){var t,n;return C(this,function(e){switch(e.label){case 0:null==i&&(i={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onTrainBegin(i)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onTrainEnd=function(i){return f(this,void 0,void 0,function(){var t,n;return C(this,function(e){switch(e.label){case 0:null==i&&(i={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onTrainEnd(i)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e}(),Je=function(e){function t(){return e.call(this)||this}return l(t,e),t.prototype.onEpochBegin=function(e,t){return f(this,void 0,void 0,function(){return C(this,function(e){return this.seen=0,this.totals={},[2]})})},t.prototype.onBatchEnd=function(e,o){return f(this,void 0,void 0,function(){var i,t,r,n,a=this;return C(this,function(e){for(n in null==o&&(o={}),i=null==o.size?0:o.size,this.seen+=i,t=function(e){var t=o[e];if("number"==typeof t)r.totals.hasOwnProperty(e)||(r.totals[e]=0),r.totals[e]=r.totals[e]+t*i;else{var n=void 0;e in r.totals?n=r.totals[e]:r.totals[e]=Y(0),r.totals[e]=P.tidy(function(){return ye(a.totals[e],P.mul(t,Y(i)))}),null!=n&&n.dispose()}},r=this,o)t(n);return[2]})})},t.prototype.onEpochEnd=function(e,s){return f(this,void 0,void 0,function(){var t,n,i,r,a,o=this;return C(this,function(e){if(null!=s)for(t=function(e){if(null==n.totals[e])return"continue";"number"==typeof n.totals[e]?s[e]=n.totals[e]/n.seen:P.tidy(function(){s[e]=me(P.div(Y(1),Y(o.seen)),o.totals[e]),o.totals[e].dispose(),P.keep(s[e])})},i=0,r=(n=this).params.metrics;i<r.length;i++)a=r[i],t(a);return[2]})})},t}(He);function Xe(l){return f(this,void 0,void 0,function(){var t,n,i,r,a,o,s;return C(this,function(e){switch(e.label){case 0:if(null==l)return[2];for(i in t=[],n=[],l)"number"!=typeof(r=l[i])&&(a=r,t.push(a.data()),n.push(i));return[4,Promise.all(t)];case 1:for(o=e.sent(),s=0;s<o.length;++s)l[n[s]]=o[s][0];return[2]}})})}var $e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.onTrainBegin=function(e){return f(this,void 0,void 0,function(){return C(this,function(e){return this.epoch=[],this.history={},[2]})})},t.prototype.onEpochEnd=function(n,i){return f(this,void 0,void 0,function(){var t;return C(this,function(e){for(t in null==i&&(i={}),this.epoch.push(n),i)null==this.history[t]&&(this.history[t]=[]),this.history[t].push(i[t]);return[2]})})},t.prototype.syncData=function(){return f(this,void 0,void 0,function(){var t,n,i,r,a,o,s,l,u;return C(this,function(e){switch(e.label){case 0:for(r in t=[],n=[],i=[],this.history)for(a=this.history[r],o=0;o<a.length;++o)"number"!=typeof a[o]&&(s=a[o],t.push(s.data()),n.push(r),i.push(o));return[4,Promise.all(t)];case 1:for(l=e.sent(),u=0;u<l.length;++u)this.history[n[u]][i[u]].dispose(),this.history[n[u]][i[u]]=l[u][0];return[2]}})})},t}(He),Ye=function(n){function e(e){var t=n.call(this)||this;return t.trainBegin=e.onTrainBegin,t.trainEnd=e.onTrainEnd,t.epochBegin=e.onEpochBegin,t.epochEnd=e.onEpochEnd,t.batchBegin=e.onBatchBegin,t.batchEnd=e.onBatchEnd,t}return l(e,n),e.prototype.onEpochBegin=function(t,n){return f(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return null==this.epochBegin?[3,3]:[4,Xe(n)];case 1:return e.sent(),[4,this.epochBegin(t,n)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,n){return f(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return null==this.epochEnd?[3,3]:[4,Xe(n)];case 1:return e.sent(),[4,this.epochEnd(t,n)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onBatchBegin=function(t,n){return f(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return null==this.batchBegin?[3,3]:[4,Xe(n)];case 1:return e.sent(),[4,this.batchBegin(t,n)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,n){return f(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return null==this.batchEnd?[3,3]:[4,Xe(n)];case 1:return e.sent(),[4,this.batchEnd(t,n)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onTrainBegin=function(t){return f(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return null==this.trainBegin?[3,3]:[4,Xe(t)];case 1:return e.sent(),[4,this.trainBegin(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return f(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return null==this.trainEnd?[3,3]:[4,Xe(t)];case 1:return e.sent(),[4,this.trainEnd(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e}(He);function Qe(i,r){return P.tidy(function(){var e=P.sum(ze(i),r,!0),t=me(P.scalar(Q()),P.onesLike(i)),n=P.sqrt(P.maximum(e,t));return P.div(i,n)})}function et(e,t){return P.tidy(function(){return P.mean(ze(P.sub(t,e)),-1)})}function tt(e,t){return P.tidy(function(){return P.mean(P.abs(P.sub(t,e)),-1)})}function nt(i,r){return P.tidy(function(){var e=P.sub(i,r),t=P.clipByValue(P.abs(i),Q(),Number.MAX_VALUE),n=P.abs(P.div(e,t));return me(Y(100),P.mean(n,-1))})}function it(a,o){return P.tidy(function(){var e=Y(1),t=P.clipByValue(o,Q(),Number.MAX_VALUE),n=P.log(ye(e,t)),i=P.clipByValue(a,Q(),Number.MAX_VALUE),r=P.log(ye(e,i));return P.mean(ze(P.sub(n,r)),-1)})}function rt(i,r){return P.tidy(function(){var e=Y(0),t=Y(1),n=P.maximum(e,P.sub(t,P.mul(i,r)));return P.mean(ze(n),-1)})}function at(i,r){return P.tidy(function(){var e=Y(0),t=Y(1),n=P.maximum(e,P.sub(t,P.mul(i,r)));return P.mean(n,-1)})}function ot(r,a){return P.tidy(function(){var e=Y(0),t=Y(1),n=P.sum(P.mul(r,a),-1),i=P.max(P.mul(P.sub(t,r),a),-1);return P.maximum(e,ye(t,P.sub(i,n)))})}function st(i,r){return P.tidy(function(){var e=Y(Math.log(2)),t=P.sub(r,i),n=P.sub(P.add(t,P.softplus(me(Y(-2),t))),e);return P.mean(n,-1)})}function lt(t,n,i){return void 0===i&&(i=!1),P.tidy(function(){if(i)n=P.softmax(n);else{var e=P.sum(n,ee(n).length-1,!0);n=P.div(n,e)}return n=P.clipByValue(n,Q(),1-Q()),P.neg(P.sum(P.mul(t.toFloat(),P.log(n)),ee(n).length-1))})}function ut(r,a,o){return void 0===o&&(o=!1),P.tidy(function(){var e,t,n=P.floor((e=r,t=[x(e.shape)],e.reshape(t))).toInt(),i=ee(a);return lt(P.oneHot(n,i[i.length-1]).reshape(i),a,o)})}function ct(t,n){return P.tidy(function(){var e,i,r;return e=P.clipByValue(n,Q(),1-Q()),e=P.log(P.div(e,P.sub(P.onesLike(e),e))),P.mean((i=t,r=e,P.tidy(function(){var e=P.maximum(r,P.zerosLike(r)),t=P.mul(r,i),n=P.log(P.add(Y(1),P.exp(P.neg(P.abs(r)))));return P.add(P.sub(e,t),n)})),-1)})}function ht(n,i){return P.tidy(function(){var e=P.clipByValue(n,Q(),1),t=P.clipByValue(i,Q(),1);return P.sum(P.mul(n,P.log(P.div(e,t))),-1)})}function pt(t,n){return P.tidy(function(){var e=P.log(ye(Y(Q()),n));return P.mean(P.sub(n,P.mul(t,e)),-1)})}function dt(i,r){return P.tidy(function(){var e=Qe(i,-1),t=Qe(r,-1),n=P.mul(e,t);return P.neg(P.sum(n,-1))})}function ft(e){var t={meanSquaredError:et,meanAbsoluteError:tt,meanAbsolutePercentageError:nt,meanSquaredLogarithmicError:it,squaredHinge:rt,hinge:at,categoricalHinge:ot,logcosh:st,categoricalCrossentropy:lt,sparseCategoricalCrossentropy:ut,binaryCrossentropy:ct,kullbackLeiblerDivergence:ht,poisson:pt,cosineProximity:dt};if("string"==typeof e){if(e in t)return t[e];throw new oe("Unknown loss "+e)}return e}function gt(n,i){return P.tidy(function(){var e=me(Y(.5),P.onesLike(i)),t=ie(P.greater(i,e),n.dtype);return P.mean(P.equal(n,t),-1)})}function mt(e,t){return P.tidy(function(){return ie(P.equal(P.argMax(e,-1),P.argMax(t,-1)),"float32")})}function yt(e,t){return ct(e,t)}function vt(e,t){throw new _}var bt=et,wt=et,zt=tt,It=tt,St=nt,Nt=nt,kt=lt,Ct=dt,Lt=ut;var At,Tt,Rt=function(){function a(e){if(this.id2Value={},e instanceof a)for(var t in e.id2Value)this.id2Value[t]=e.id2Value[t];else{if(null==e)return;for(var n=0,i=e;n<i.length;n++){var r=i[n];this.add(r.key,r.value)}}}return a.prototype.add=function(e,t){if(function(e,t){if(null!=e.dtype&&e.dtype!==t.dtype)throw new oe("The dtype of the feed ("+t.dtype+") is incompatible with that of the key '"+e.name+"' ("+e.dtype+").");if(null!=e.shape){if(e.shape.length!==t.shape.length)throw new oe("The rank of feed ("+t.shape.length+") does not match the rank of the key ("+e.shape.length+").");for(var n=0;n<e.shape.length;++n)if(null!=e.shape[n]&&e.shape[n]!==t.shape[n])throw new oe("The "+n+"-th dimension of the feed ("+t.shape[n]+") is incompatible with that of the key ("+e.shape[n]+").")}}(e,t),null!=this.id2Value[e.id])throw new oe("Duplicate key: name="+e.name+", id="+e.id);return this.id2Value[e.id]=t,this},a.prototype.addFeed=function(e){this.add(e.key,e.value)},a.prototype.hasKey=function(e){return null!=this.id2Value[e.id]},a.prototype.getValue=function(e){if(null==this.id2Value[e.id])throw new oe("Nonexistent key: "+JSON.stringify(e));return this.id2Value[e.id]},a}();function Dt(e,t,n){for(var i=Array.isArray(e),r=i?e:[e],a=[],o=new Rt(t),s=0,l=r;s<l.length;s++){var u=l[s];a.push(Ft(u,o,n))}return i?a:a[0]}function Ft(e,t,n){if(t.hasKey(e))return t.getValue(e);if(e.sourceLayer instanceof Ve)throw new oe("Missing a feed value for SymbolicTensor from InputLayer '"+Ve.name+"'");for(var i=[],r=0,a=e.inputs;r<a.length;r++){var o=Ft(a[r],t,n);i.push(o)}var s=e.sourceLayer.apply(i,n);Array.isArray(s)||(s=[s]);for(var l=function(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,i=0;i<e.sourceLayer.inboundNodes.length;++i)for(var r=0,a=e.sourceLayer.inboundNodes[i].outputTensors;r<a.length;r++){var o=a[r];if(o.id===e.id){n=i;break}}t=e.sourceLayer.getOutputAt(n)}return t}(e),u=Array.isArray(l)?l:[l],c=0;c<u.length;++c)t.add(u[c],s[c]);return 1===s.length?s[0]:s[e.outputTensorIndex]}function Ot(e){return Array.isArray(e)}function Mt(e){return!(e instanceof P.Tensor||Ot(e))}function Et(e,t,n,i,r){if(void 0===i&&(i=!0),void 0===r&&(r=""),null==t||0===t.length){if(null!=e){var a=!1;if(Ot(e)&&0<e.length)a=!0;else if(Mt(e)){for(var o in e)if(e.hasOwnProperty(o)){a=!0;break}}else a=!0;if(a)throw new oe("Error when checking model "+r+" expected no data, but got "+e)}return[]}if(null==e)return t.map(function(e){return null});var s;if(Mt(e)){e=e,s=[];for(var l=0,u=t;l<u.length;l++){var c=u[l];if(null==e[c])throw new oe('No data provided for "'+c+'". Need data for each key in: '+t);s.push(e[c])}}else if(Ot(e)){if((e=e).length!==t.length)throw new oe("Error when checking model "+r+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+t.length+" Tensor(s), but instead got the following list of Tensor(s): "+e);s=e}else{if(e=e,1<t.length)throw new oe("The model "+r+" expects "+t.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+e.shape);s=[e]}for(var h=0;h<t.length;++h){1===(p=s[h]).shape.length&&(s[h]=re(p,1))}if(null!=n)for(h=0;h<t.length;++h)if(null!=n[h]){var p;if((p=s[h]).shape.length!==n[h].length)throw new oe("Error when checking "+r+": expected "+t[h]+" to have "+n[h].length+" dimension(s). but got array with shape "+p.shape);for(var d=0;d<n[h].length;++d)if(0!==d||i){var f=p.shape[d],g=n[h][d];if(null!=g&&0<=g&&f!==g)throw new oe("Error when checking "+r+": expected "+t[h]+" to have shape ["+n[h]+"], but got array with shape ["+p.shape+"].")}}return s}function xt(e,t){for(var n=[],i=0,r=null;i<e;)e<=(r=i+t)&&(r=e),n.push([i,r]),i=r;return n}function Pt(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(function(e){return ce(e,t,n-t)}):ce(e,t,n-t)}function _t(e,t){return P.tidy(function(){return null==e?null:Array.isArray(e)?e.map(function(e){return _t(e,t)}):we(e,"int32"===t.dtype?t:t.toInt())})}function Bt(e,t,n,i,r){var a;if(void 0===i&&(i=!0),void 0===r&&(r=""),Array.isArray(e)){if(e.length!==t.length)throw new oe("Error when checking model "+r+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+t.length+" Tensor(s), but instead got "+e.length+" Tensors(s).");a=e}else{if(1<t.length)throw new oe("The model expects "+t.length+" "+r+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(e.shape)+".");a=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=a[o];if(s.shape.length!==n[o].length)throw new oe("Error when checking "+r+": expected "+t[o]+" to have "+n[o].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var l=0;l<n[o].length;++l)if(0!==l||i){var u=s.shape[l],c=n[o][l];if(null!=c&&c!==u)throw new oe("Error when checking "+r+": expected "+t[o]+" to have shape "+JSON.stringify(n[o])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}(Tt=At||(At={}))[Tt.SILENT=0]="SILENT",Tt[Tt.VERBOSE=1]="VERBOSE";var Ut=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.compile=function(e){var p=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer=function(e){var t={Adagrad:function(){return P.train.adagrad(.01)},Adam:function(){return P.train.adam(.001,.9,.999,Q())},RMSProp:function(){return P.train.rmsprop(.001,.9,null,Q())},SGD:function(){return P.train.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adam=t.Adam,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new oe("Unknown Optimizer "+e)}(e.optimizer);else{if(!(e.optimizer instanceof P.Optimizer))throw new oe("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer=e.optimizer}var t=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new oe("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+e.loss+".");var n=e.loss;t=n.map(function(e){return ft(e)})}else{var i=ft(e.loss);this.outputs.map(function(e){t.push(i)})}else{for(var r in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(r))throw new oe('Unknown entry in loss dictionary: "'+r+'". Only expect the following keys: '+this.outputNames);for(var a in this.outputNames)null==e.loss[a]&&console.warn('Output "'+a+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+a+" during training"),t.push(ft(e.loss[a]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var o=0;o<this.outputs.length;++o){var s=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(s),this.feedLossFns.push(this.lossFunctions[o])}var u=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Se("loss",function(){for(var e=0;e<p.outputs.length;++e)if(-1===u.indexOf(e)){var t=p.lossFunctions[e];1<p.outputs.length&&(p.metricsTensors.push([t,e]),p.metricsNames.push(p.outputNames[e]+"_loss"))}});var c=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map(function(e){return[]});if(Array.isArray(t))return e.map(function(e){return t});if(null!=t){for(var n=[],i=0,r=e;i<r.length;i++){var a=r[i],o=t.hasOwnProperty(a)?t[a]:[];Array.isArray(o)||(o=[o]),n.push(o)}return n}throw new TypeError("Type of metrics argument not understood. Expected an Array or Object, found: "+t)}(e.metrics,this.outputNames);Se("metric",function(){for(var e=function(h){if(-1!==u.indexOf(h))return"continue";!function(e){for(var l,u,c,t=function(e){if(-1!==["accuracy","acc","crossentropy","ce"].indexOf(e)){var t=p.internalOutputShapes[h];1===t[t.length-1]||p.lossFunctions[h]===ct?-1!==["accuracy","acc"].indexOf(e)?u=gt:-1!==["crossentropy","ce"].indexOf(e)&&(u=yt):p.lossFunctions[h]===ut?-1!==["accuracy","acc"].indexOf(e)?u=vt:-1!==["crossentropy","ce"].indexOf(e)&&(u=Lt):-1!==["accuracy","acc"].indexOf(e)?u=mt:-1!==["crossentropy","ce"].indexOf(e)&&(u=kt);var n=void 0;-1!==["accuracy","acc"].indexOf(e)?n="acc":-1!==["crossentropy","ce"].indexOf(e)&&(n="ce"),c=u,l=""+n}else{var i=function(e){var t={binaryAccuracy:gt,categoricalAccuracy:mt,categoricalCrossentropy:kt,sparseCategoricalCrossentropy:Lt,mse:bt,MSE:wt,mae:zt,MAE:It,mape:St,MAPE:Nt,cosine:Ct};if("string"==typeof e&&e in t)return t[e];if("string"!=typeof e&&null!=e)return e;throw new oe("Unknown metric "+e)}(e);c=i,l=""+e}var r,a,o,s;Se(l,function(){r=c}),a=h,o=l,s=r,1<p.outputNames.length&&(o=p.outputNames[a]+"_"+o),p.metricsNames.push(o),p.metricsTensors.push([s,a])},n=0,i=e;n<i.length;n++)t(i[n])}(c[h])},t=0;t<p.outputs.length;++t)e(t)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(e,t,n){void 0===n&&(n={});var i=null==n.batchSize?32:n.batchSize,r=this.standardizeUserData(e,t,!0,i),a=r[0].concat(r[1]);this.makeTestFunction();var o=this.testFunction;return L(this.testLoop(o,a,i,n.verbose,n.steps))},e.prototype.checkNumSamples=function(e,t,n,i){var r;if(void 0===i&&(i="steps"),null!=n){if((r=null)!=t)throw new oe("If "+i+" is set, batchSize must be null or undefined.Got batchSize = "+t)}else{if(null==e)throw new oe("Either the input data should have a defined shape, or "+i+" shoud be specified.");r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r},e.prototype.predictLoop=function(s,e,t){var l=this;void 0===e&&(e=32),void 0===t&&(t=!1);var n=this.checkNumSamples(s);if(t)throw new _("Verbose predictLoop() is not implemented yet.");for(var u=xt(n,e),a=[],i=function(o){var e=P.tidy(function(){var e=u[o][0],t=u[o][1],n=Pt(s,e,t),i=[];if(Array.isArray(n))for(var r=0;r<n.length;++r)i.push({key:l.inputs[r],value:n[r]});else i.push({key:l.inputs[0],value:n});var a=new Rt(i);return Dt(l.outputs,a)});if(0===o)for(var t=0,n=e;t<n.length;t++){var i=n[t];a.push(i)}else for(var r=0;r<e.length;++r)a[r]=fe(a[r],e[r])},r=0;r<u.length;++r)i(r);return L(a)},e.prototype.predict=function(e,t){void 0===t&&(t={}),Bt(e,this.inputNames,this.feedInputShapes,!1);var n=null==t.batchSize?32:t.batchSize;return this.predictLoop(e,n)},e.prototype.predictOnBatch=function(e){return Bt(e,this.inputNames,this.feedInputShapes,!0),this.predictLoop(e,e.shape[0])},e.prototype.standardizeUserData=function(e,t,n,i){if(void 0===n&&(n=!0),null==this.optimizer)throw new ae("You must compile a model before training/testing. Use Model.compile(modelCompileConfig).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var o=this.feedOutputShapes[a];this.feedLossFns[a]===ut?r.push(o.slice(0,o.length-1).concat([1])):r.push(o)}if(function(e,t,n){var i=ue(e.map(function(e){return e.shape[0]}));i.sort();var r=ue(t.map(function(e){return e.shape[0]}));if(r.sort(),1<i.length)throw new oe("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(function(e){return e.shape})));if(1<r.length)throw new oe("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(function(e){return e.shape})));if(0<i.length&&0<r.length&&!P.util.arraysEqual(i,r))throw new oe("Input Tensors should have the same number of samples as target Tensors. Found "+i[0]+" input sample(s) and "+r[0]+" target sample(s).")}(e=Et(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=Et(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){for(var i=[et,ct,lt],r=0;r<e.length;++r){var a=e[r],o=t[r],s=n[r];if(null!=o){if(o===lt&&1===a.shape[a.shape.length-1])throw new oe("You are passing a target array of shape "+a.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==i.indexOf(o))for(var l=a.shape.slice(1),u=s.slice(1),c=0;c<l.length;++c){var h=l[c],p=u[c];if(null!=p&&h!==p)throw new oe("A target Tensor with shape "+a.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=i&&0<i&&e[0].shape[0]%i!=0)throw new oe("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+i+". Found: "+e[0].shape[0]+" sample(s).");return[e,t,null]},e.prototype.fitLoop=function(m,y,v,b,i,l,u,w,z,c,h,p,I,d){return void 0===p&&(p=0),f(this,void 0,void 0,function(){var f,r,a,o,t,s,n,g=this;return C(this,function(e){switch(e.label){case 0:if(null==b&&(b=32),null==i&&(i=1),null==c&&(c=!0),null==p&&(p=0),f=!1,null!=w&&null!=z&&(f=!0),null!=d&&(f=!0,null==I))throw new oe("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");if(null!=(r=this.checkNumSamples(y,b,I,"steps_per_epoch"))&&(a=W(0,r)),this.history=new $e,u=(u=null==u?[new Je]:[new Je].concat(u)).concat([this.history]),0<l)throw new _("Verbose mode is not implemented yet.");return(o=new Ge(u)).setModel(this),o.setParams({epochs:i,steps:I,verbose:l,doValidation:f,metrics:h}),[4,o.onTrainBegin()];case 1:e.sent(),this.stopTraining=!1,t=function(t){var h,p,d,n,i;return C(this,function(e){switch(e.label){case 0:return[4,o.onEpochBegin(t)];case 1:if(e.sent(),h={},null==I)return[3,2];throw new _("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===c)throw new _("batch shuffling is not implemneted yet");c&&P.util.shuffle(a),p=P.tensor1d(a),d=xt(r,b),n=function(u){var c;return C(this,function(e){switch(e.label){case 0:return c={},[4,o.onBatchBegin(u,c)];case 1:return e.sent(),P.tidy(function(){var e=d[u][0],t=d[u][1],n=ce(p,e,t-e);c.batch=u,c.size=t-e;for(var i=_t(y,n),r=m(i),a=0;a<v.length;++a){var o=v[a],s=r[a];c[o]=s,P.keep(s)}if(u===d.length-1&&f){var l=g.testLoop(w,z,b);for(a=0;a<v.length;++a){o=v[a],s=l[a];P.keep(s),h["val_"+o]=s}}}),[4,o.onBatchEnd(u,c)];case 2:return e.sent(),function(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}(c),s.stopTraining?[2,"break"]:[2]}})},i=0,e.label=3;case 3:return i<d.length?[5,n(i)]:[3,6];case 4:if("break"===e.sent())return[3,6];e.label=5;case 5:return++i,[3,3];case 6:p.dispose(),e.label=7;case 7:return[4,o.onEpochEnd(t,h)];case 8:return e.sent(),s.stopTraining?[2,"break"]:[2]}})},s=this,n=p,e.label=2;case 2:return n<i?[5,t(n)]:[3,5];case 3:if("break"===e.sent())return[3,5];e.label=4;case 4:return++n,[3,2];case 5:return[4,o.onTrainEnd()];case 6:return e.sent(),[4,this.history.syncData()];case 7:return e.sent(),[2,this.history]}})})},e.prototype.testLoop=function(e,t,n,i,r){void 0===i&&(i=0);var a=this.checkNumSamples(t,n,r,"steps"),o=[];if(1===i)throw new _("Verbose mode is not implemented yet.");if(null!=r)throw new _("steps mode in testLoop() is not implemented yet");for(var s=xt(a,n),l=P.tensor1d(W(0,a)),u=0;u<s.length;++u){var c=s[u][0],h=s[u][1],p=e(_t(t,ce(l,c,h-c)));if(0===u)for(var d=0;d<p.length;++d)o.push(Y(0));for(d=0;d<p.length;++d){var f=p[d];o[d]=P.add(o[d],me(Y(h-c),f))}}for(d=0;d<o.length;++d)o[d]=P.div(o[d],Y(a));return o},e.prototype.getDedupedMetricsNames=function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var i=e[n],r=i;if(1<a(e,i))r+="_"+a(e.slice(0,n),i);t.push(r)}return t},e.prototype.makeTestFunction=function(){var f=this;this.testFunction=function(d){return P.tidy(function(){for(var e,t=[],n=d.slice(0,f.inputs.length),i=d.slice(f.inputs.length,f.inputs.length+f.outputs.length),r=[],a=0;a<f.inputs.length;++a)r.push({key:f.inputs[a],value:n[a]});var o=new Rt(r),s=Dt(f.outputs,o);for(a=0;a<f.lossFunctions.length;++a){var l=f.lossFunctions[a],u=P.mean(l(i[a],s[a]));e=0===a?u:P.add(e,u),t.push(e)}for(a=0;a<f.metricsTensors.length;++a){var c=f.metricsTensors[a][0],h=f.metricsTensors[a][1],p=P.mean(c(i[h],s[h]));t.push(p)}return t})}},e.prototype.fit=function(I,S,N){return void 0===N&&(N={}),f(this,void 0,void 0,function(){var n,i,r,a,o,s,l,u,c,h,p,d,f,g,m,y,v,b,w,z=this;return C(this,function(e){switch(e.label){case 0:if(n=null==N.batchSize?32:N.batchSize,i=this.standardizeUserData(I,S,!1,n),r=i[0],a=i[1],c=o=!1,null!=N.validationData&&0<N.validationData.length){if(o=!0,2!==N.validationData.length)throw 3===N.validationData.length?new _("validationData including sample weights is not supported yet."):new oe("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+N.validationData+" is invalid.");s=N.validationData[0],l=N.validationData[1],h=this.standardizeUserData(s,l,!0,n),s=h[0],l=h[1],u=s.concat(l)}else null!=N.validationSplit&&0<N.validationSplit&&N.validationSplit<1?(o=!0,p=Math.floor(r[0].shape[0]*(1-N.validationSplit)),d=r[0].shape[0],s=Pt(r,p,d),r=Pt(r,0,p),l=Pt(a,p,d),a=Pt(a,0,p),c=!0,u=s.concat(l)):null!=N.validationSteps&&(o=!0);return f=r.concat(a),this.checkTrainableWeightsConsistency(),g=function(e){var u=e.slice(0,z.inputs.length),c=e.slice(z.inputs.length,z.inputs.length+z.outputs.length),h=[],t=z.collectedTrainableWeights.map(function(e){return e.read()});return[z.optimizer.minimize(function(){for(var e=[],t=0;t<z.inputs.length;++t)e.push({key:z.inputs[t],value:u[t]});var n,i=new Rt(e),r=Dt(z.outputs,i,{training:!0});for(t=0;t<z.lossFunctions.length;++t){var a=(0,z.lossFunctions[t])(c[t],r[t]);P.mean(a),n=0===t?a:P.add(n,a)}for(t=0;t<z.metricsTensors.length;++t){var o=z.metricsTensors[t][0],s=z.metricsTensors[t][1],l=P.mean(o(c[s],r[s]));P.keep(l),h.push(l)}return n=P.mean(n),z.calculateLosses().forEach(function(e){n=P.add(n,e)}),n},!0,t)].concat(h)},m=this.getDedupedMetricsNames(),o?(this.makeTestFunction(),y=this.testFunction,v=m.slice().concat(m.map(function(e){return"val_"+e}))):(y=null,u=[],v=m.slice()),t=N.callbacks,b=null==t?null:t instanceof He?[t]:Array.isArray(t)&&t[0]instanceof He?t:E(t).map(function(e){return new Ye(e)}),[4,this.fitLoop(g,f,m,n,N.epochs,N.verbose,b,y,u,N.shuffle,v,null,null,null)];case 1:return w=e.sent(),c&&(u.forEach(function(e){return e.dispose()}),r.forEach(function(e){return e.dispose()}),a.forEach(function(e){return e.dispose()})),[2,w]}var t})})},e.prototype.getNamedWeights=function(e){for(var t={},n=null!=e&&e.trainableOnly,i=n?this.trainableWeights:this.weights,r=this.getWeights(n),a=0;a<i.length;++a)n&&!i[a].trainable||(t[i[a].originalName]=r[a]);return t},e.prototype.save=function(r,a){return f(this,void 0,void 0,function(){var t,n,i;return C(this,function(e){switch(e.label){case 0:if("string"==typeof r){if(0===(t=P.io.getSaveHandlers(r)).length)throw new oe("Cannot find any save handlers for URL '"+r+"'");if(1<t.length)throw new oe("Found more than one ("+t.length+") save handlers for URL '"+r+"'");r=t[0]}if(null==r.save)throw new oe("Model.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,P.io.encodeWeights(this.getNamedWeights(a))];case 1:return n=e.sent(),!1,null,i=this.toJSON(null,!1),[2,r.save({modelTopology:i,weightData:n.data,weightSpecs:n.specs})]}})})},e.className="Model",n([P.doc({heading:"Models",subheading:"Classes",configParamIndices:[0]})],e.prototype,"compile",null),n([P.doc({heading:"Models",subheading:"Classes",configParamIndices:[2]})],e.prototype,"evaluate",null),n([P.doc({heading:"Models",subheading:"Classes",configParamIndices:[1]})],e.prototype,"predict",null),n([P.doc({heading:"Models",subheading:"Classes"})],e.prototype,"predictOnBatch",null),n([P.doc({heading:"Models",subheading:"Classes",configParamIndices:[2]})],e.prototype,"fit",null),e=n([P.doc({heading:"Models",subheading:"Classes"})],e)}(Ze);P.serialization.SerializationMap.register(Ut);var jt=["fanIn","fanOut","fanAvg"];var Wt=["normal","uniform"];var Vt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.fromConfigUsesCustomObjects=function(){return!1},t.prototype.getConfig=function(){return{}},t=n([P.doc({heading:"Initializers",subheading:"Classes",namespace:"initializers"})],t)}(P.serialization.Serializable),qt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e,t){return P.zeros(e,t)},t.className="Zeros",t}(Vt);P.serialization.SerializationMap.register(qt);var Zt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e,t){return P.ones(e,t)},t.className="Ones",t}(Vt);P.serialization.SerializationMap.register(Zt);var Kt=function(n){function e(e){var t=n.call(this)||this;return t.value=e.value,t}return l(e,n),e.prototype.apply=function(e,t){var n=this;return P.tidy(function(){return me(P.scalar(n.value),P.ones(e,t))})},e.prototype.getConfig=function(){return{value:this.value}},e.className="Constant",e}(Vt);P.serialization.SerializationMap.register(Kt);var Ht=function(n){function e(e){var t=n.call(this)||this;return t.DEFAULT_MINVAL=-.05,t.DEFAULT_MAXVAL=.05,t.minval=e.minval||t.DEFAULT_MINVAL,t.maxval=e.maxval||t.DEFAULT_MAXVAL,t.seed=e.seed,t}return l(e,n),e.prototype.apply=function(e,t){return P.randomUniform(e,this.minval,this.maxval,t)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e.className="RandomUniform",e}(Vt);P.serialization.SerializationMap.register(Ht);var Gt=function(n){function e(e){var t=n.call(this)||this;return t.DEFAULT_MEAN=0,t.DEFAULT_STDDEV=.05,t.mean=e.mean||t.DEFAULT_MEAN,t.stddev=e.stddev||t.DEFAULT_STDDEV,t.seed=e.seed,t}return l(e,n),e.prototype.apply=function(e,t){if("bool"===t)throw new _("randomNormal does not support dType bool.");return ve(e,this.mean,this.stddev,t,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="RandomNormal",e}(Vt);P.serialization.SerializationMap.register(Gt);var Jt=function(n){function e(e){var t=n.call(this)||this;return t.DEFAULT_MEAN=0,t.DEFAULT_STDDEV=.05,t.mean=e.mean||t.DEFAULT_MEAN,t.stddev=e.stddev||t.DEFAULT_STDDEV,t.seed=e.seed,t}return l(e,n),e.prototype.apply=function(e,t){if("bool"===t)throw new _("truncatedNormal does not support dType bool.");return P.truncatedNormal(e,this.mean,this.stddev,t,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="TruncatedNormal",e}(Vt);P.serialization.SerializationMap.register(Jt);var Xt=function(n){function e(e){var t=n.call(this)||this;return t.gain=null!=e.gain?P.scalar(e.gain):Y(1),t}return l(e,n),e.prototype.apply=function(e,t){var n=this;return P.tidy(function(){if(2!==e.length||e[0]!==e[1])throw new oe("Identity matrix initializer can only be used for 2D square matrices.");return me(n.gain,P.eye(e[0]))})},e.prototype.getConfig=function(){return{gain:this.gain.get()}},e.className="Identity",e}(Vt);P.serialization.SerializationMap.register(Xt);var $t=function(r){function e(e){var t,n,i=r.call(this)||this;if(e.scale<0)throw new oe("scale must be a positive float. Got: "+e.scale);return i.scale=null==e.scale?1:e.scale,i.mode=e.mode,t=i.mode,p(jt,"FanMode",t),i.distribution=e.distribution,n=i.distribution,p(Wt,"Distribution",n),i.seed=e.seed,i}return l(e,r),e.prototype.apply=function(e,t){var n=function(e,t){var n,i;if(void 0===t&&(t="channelsLast"),b(t),2===e.length)n=e[0],i=e[1];else if(-1!==[3,4,5].indexOf(e.length))if("channelsFirst"===t){var r=x(e,2);n=e[1]*r,i=e[0]*r}else"channelsLast"===t&&(r=x(e,0,e.length-2),n=e[e.length-2]*r,i=e[e.length-1]*r);else{var a=x(e);n=Math.sqrt(a),i=Math.sqrt(a)}return[n,i]}(e),i=n[0],r=n[1],a=this.scale;if("fanIn"===this.mode?a/=Math.max(1,i):"fanOut"===this.mode?a/=Math.max(1,r):a/=Math.max(1,(i+r)/2),"normal"===this.distribution){var o=Math.sqrt(a);if("bool"===t)throw new _(this.getClassName()+" does not support dType bool.");return P.truncatedNormal(e,0,o,t,this.seed)}var s=Math.sqrt(3*a);return P.randomUniform(e,-s,s,t)},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e.className="VarianceScaling",e}(Vt);P.serialization.SerializationMap.register($t);var Yt=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})||this}return l(e,t),e.prototype.getClassName=function(){return $t.className},e}($t),Qt=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})||this}return l(e,t),e.prototype.getClassName=function(){return $t.className},e}($t),en=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return l(e,t),e.prototype.getClassName=function(){return $t.className},e}($t),tn=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return l(e,t),e.prototype.getClassName=function(){return $t.className},e}($t),nn=function(n){function e(e){var t=n.call(this)||this;if(t.DEFAULT_GAIN=1,t.gain=null==e.gain?t.DEFAULT_GAIN:e.gain,t.seed=e.seed,null!=t.seed)throw new _("Random seed is not implemented for Orthogonal Initializer yet.");return t}return l(e,n),e.prototype.apply=function(n,e){var i=this;return P.tidy(function(){if(2!==n.length)throw new _("The Orthogonal Initializer does not support non-2D shapes yet.");2e3<n[0]*n[1]&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+n[0]*n[1]+") elements: Slowness may result.");var e=ve(n[0]>n[1]?[n[1],n[0]]:n,0,1,"float32"),t=P.linalg.gramSchmidt(e);return n[0]>n[1]&&(t=t.transpose()),me(Y(i.gain),t)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e.className="Orthogonal",e}(Vt);P.serialization.SerializationMap.register(nn);var rn={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",identity:"Identity",leCunNormal:"LeCunNormal",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function an(e,t){return void 0===t&&(t={}),o(e,P.serialization.SerializationMap.getMap().classNameMap,t,"initializer")}function on(e){return t(e)}function sn(e){if("string"==typeof e){var t=e in rn?rn[e]:e;return"GlorotUniform"===t?new Yt:"GlorotNormal"===t?new Qt:"HeNormal"===t?new en:"LeCunNormal"===t?new tn:an({className:t,config:{}})}return e instanceof Vt?e:an(e)}var ln=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.getConfig=function(){return{}},t}(P.serialization.Serializable),un=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=1),function(e,t){if(void 0===t&&(t=1),1!==t)throw new _("Support for alpha values other than 1 ("+t+") is not implemented yet.");return P.elu(e)}(e,t)},t.className="elu",t}(ln);P.serialization.SerializationMap.register(un);var cn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e){return P.selu(e)},t.className="selu",t}(ln);P.serialization.SerializationMap.register(cn);var hn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e){return P.relu(e)},t.className="relu",t}(ln);P.serialization.SerializationMap.register(hn);var pn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e){return P.tidy(function(){return P.minimum(Y(6),P.relu(e))})},t.className="relu6",t}(ln);P.serialization.SerializationMap.register(pn);var dn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e){return e},t.className="linear",t}(ln);P.serialization.SerializationMap.register(dn);var fn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e){return P.sigmoid(e)},t.className="sigmoid",t}(ln);P.serialization.SerializationMap.register(fn);var gn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e){return t=e,P.tidy(function(){var e=ye(Y(.5),me(Y(.2),t));return P.clipByValue(e,0,1)});var t},t.className="hardSigmoid",t}(ln);P.serialization.SerializationMap.register(gn);var mn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e){return P.softplus(e)},t.className="softplus",t}(ln);P.serialization.SerializationMap.register(mn);var yn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e){return t=e,P.tidy(function(){return P.div(t,P.add(Y(1),P.abs(t)))});var t},t.className="softsign",t}(ln);P.serialization.SerializationMap.register(yn);var vn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e){return P.tanh(e)},t.className="tanh",t}(ln);P.serialization.SerializationMap.register(vn);var bn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=-1),P.softmax(e,t)},t.className="softmax",t}(ln);function wn(e){return e.getClassName()}function zn(e,t){return void 0===t&&(t={}),o(e,P.serialization.SerializationMap.getMap().classNameMap,t,"activation")}function In(e){return null==e?zn({className:"linear",config:{}}):"string"==typeof e?zn({className:e,config:{}}):e instanceof ln?e:zn(e)}P.serialization.SerializationMap.register(bn);var Sn=function(n){function e(e){var t=n.call(this,null==e?{}:e)||this;return t.DEFAULT_ALPHA=.3,null==e&&(e={}),t.alpha=null==e.alpha?t.DEFAULT_ALPHA:e.alpha,t}return l(e,n),e.prototype.call=function(e,t){var n=v(e);return P.leakyRelu(n,this.alpha)},e.prototype.computeOutputShape=function(e){return e},e.prototype.getConfig=function(){var e={alpha:this.alpha},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="LeakyReLU",e}(We);P.serialization.SerializationMap.register(Sn);var Nn=function(n){function e(e){var t=n.call(this,null==e?{}:e)||this;if(t.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==t.DEFAULT_ALPHA)throw new _("Non-default alpha value ("+e.alpha+") is not supported by the ELU layer yet.");return t.alpha=null==e.alpha?t.DEFAULT_ALPHA:e.alpha,t}return l(e,n),e.prototype.call=function(e,t){var n=v(e);return P.elu(n)},e.prototype.computeOutputShape=function(e){return e},e.prototype.getConfig=function(){var e={alpha:this.alpha},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="ELU",e}(We);P.serialization.SerializationMap.register(Nn);var kn=function(n){function e(e){var t=n.call(this,null==e?{}:e)||this;return t.DEFAULT_THETA=1,null==e&&(e={}),t.theta=null==e.theta?t.DEFAULT_THETA:e.theta,t.thetaTensor=Y(t.theta),t}return l(e,n),e.prototype.call=function(e,t){var n=v(e);return n.mul(ie(n.greater(this.thetaTensor),"float32"))},e.prototype.computeOutputShape=function(e){return e},e.prototype.getConfig=function(){var e={theta:this.theta},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="ThresholdedReLU",e}(We);P.serialization.SerializationMap.register(kn);var Cn=function(n){function e(e){var t=n.call(this,null==e?{}:e)||this;return t.DEFAULT_AXIS=1,null==e&&(e={}),t.softmax=(new bn).apply,t.axis=null==e.axis?t.DEFAULT_AXIS:e.axis,t}return l(e,n),e.prototype.call=function(e,t){var n=v(e);return this.softmax(n,this.axis)},e.prototype.computeOutputShape=function(e){return e},e.prototype.getConfig=function(){var e={axis:this.axis},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Softmax",e}(We);P.serialization.SerializationMap.register(Cn);var Ln=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t}(P.serialization.Serializable),An=function(r){function e(e){var t=r.call(this)||this,n=null==e||null==e.l1?.01:e.l1,i=null==e||null==e.l2?.01:e.l2;return t.hasL1=0!==n,t.hasL2=0!==i,t.l1=Y(n),t.l2=Y(i),t}return l(e,r),e.prototype.apply=function(t){var n=this;return P.tidy(function(){var e=P.zeros([1]);return n.hasL1&&(e=P.add(e,P.sum(me(n.l1,P.abs(t))))),n.hasL2&&(e=P.add(e,P.sum(me(n.l2,ze(t))))),e.asScalar()})},e.prototype.getConfig=function(){return{l1:this.l1.dataSync()[0],l2:this.l2.dataSync()[0]}},e.fromConfig=function(e,t){return new e({l1:t.l1,l2:t.l2})},e.className="L1L2",e=n([P.doc({heading:"Regularizers",namespace:"regularizers"})],e)}(Ln);P.serialization.SerializationMap.register(An);var Tn={l1l2:"L1L2"};function Rn(e){return t(e)}function Dn(e,t){return void 0===t&&(t={}),o(e,P.serialization.SerializationMap.getMap().classNameMap,t,"regularizer")}function Fn(e){return null==e?null:"string"==typeof e?Dn({className:e in Tn?Tn[e]:e,config:{}}):e instanceof Ln?e:Dn(e)}function On(e,t,n){if("number"==typeof e)return M(e,t);if(e.length!==t)throw new oe("The "+n+" argument must be a tuple of "+t+" integers. Received: "+e.length+" elements.");for(var i=0;i<t;++i){var r=e[i];if((a=r)!==parseInt(a.toString(),10))throw new oe("The "+n+" argument must be a tuple of "+t+" integers. Received: "+JSON.stringify(e)+" including a non-integer number "+r)}return e;var a}function Mn(e,t,n,i,r){return void 0===r&&(r=1),null==e?e:(a="same"===n?e:e-(t+(t-1)*(r-1))+1,Math.floor((a+i-1)/i));var a}function En(e,t,n,i){if(null==e)return null;if("valid"===i)e=e*t+j([n-t,0]);else{if("same"!==i)throw new oe("Unsupport padding mode: "+i+".");e*=t}return e}function xn(e,t){return P.tidy(function(){return b(t),"channelsFirst"===t?P.transpose(e,[0,2,3,1]):e})}var Pn=function(i){function e(e,t){var n=i.call(this,t)||this;if(n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.rank=e,1!==n.rank&&2!==n.rank)throw new _("Convolution layer for rank other than 1 or 2 ("+n.rank+") is not implemented yet.");if(n.filters=t.filters,n.kernelSize=On(t.kernelSize,e,"kernelSize"),n.strides=On(null==t.strides?1:t.strides,e,"strides"),n.padding=null==t.padding?"valid":t.padding,w(n.padding),n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,b(n.dataFormat),n.dilationRate=null==t.dilationRate?1:t.dilationRate,1===n.rank&&Array.isArray(n.dilationRate)&&1!==n.dilationRate.length)throw new oe("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(n.dilationRate));if(2===n.rank)if("number"==typeof n.dilationRate)n.dilationRate=[n.dilationRate,n.dilationRate];else if(2!==n.dilationRate.length)throw new oe("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(n.dilationRate));return n.activation=In(t.activation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=sn(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=sn(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=Ee(t.kernelConstraint),n.biasConstraint=Ee(t.biasConstraint),n.kernelRegularizer=Fn(t.kernelRegularizer),n.biasRegularizer=Fn(t.biasRegularizer),n.activityRegularizer=Fn(t.activityRegularizer),n}return l(e,i),e.prototype.build=function(e){e=h(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new oe("The channel dimension of the input should be defined. Found "+e[t]);var n,i=e[t],r=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[t]=i,n)}],this.built=!0},e.prototype.call=function(m,e){var y=this;return P.tidy(function(){var e;m=v(m);var t,n,i,r,a,o,s,l,u,c,h,p,d,f,g=null==y.bias?null:y.bias.read();if(1===y.rank)l=m,u=y.kernel.read(),c=g,h=y.strides[0],p=y.padding,d=y.dataFormat,f=y.dilationRate,void 0===h&&(h=1),void 0===p&&(p="valid"),void 0===f&&(f=1),e=P.tidy(function(){if(null==d&&(d="channelsLast"),b(d),3!==l.shape.length)throw new oe("The input of a conv1dWithBias operation should be 3, but is "+l.shape.length+" instead.");if(3!==u.shape.length)throw new oe("The kernel for a conv1dWithBias operation should be 3, but is "+u.shape.length+" instead");if(null!=c&&1!==c.shape.length)throw new oe("The bias for a conv1dWithBias operation should be 1, but is "+u.shape.length+" instead");if("channelsFirst"===d&&(l=P.transpose(l,[0,2,1])),"causal"===p)throw new _("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var e=P.conv1d(l,u,h,"same"===p?"same":"valid","NWC",f);return null!=c&&(e=Ie(e,c)),e});else if(2===y.rank)t=m,n=y.kernel.read(),i=g,r=y.strides,a=y.padding,o=y.dataFormat,s=y.dilationRate,void 0===r&&(r=[1,1]),void 0===a&&(a="valid"),e=P.tidy(function(){if(null==o&&(o="channelsLast"),b(o),3!==t.rank&&4!==t.rank)throw new oe("conv2dWithBias expects input to be of rank 3 or 4, but received "+t.rank+".");if(3!==n.rank&&4!==n.rank)throw new oe("conv2dWithBias expects kernel to be of rank 3 or 4, but received "+t.rank+".");var e=xn(t,o);if("causal"===a)throw new _("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return e=P.conv2d(e,n,r,"same"===a?"same":"valid","NHWC",s),null!=i&&(e=Ie(e,i)),"channelsFirst"===o&&(e=P.transpose(e,[0,3,1,2])),e});else if(3===y.rank)throw new _("3D convolution is not implemented yet.");return null!=y.activation&&(e=y.activation.apply(e)),e})},e.prototype.computeOutputShape=function(e){e=h(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),i=0;i<n.length;++i){var r=Mn(n[i],this.kernelSize[i],this.padding,this.strides[i],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[i]);t.push(r)}var a=[e[0]];return"channelsLast"===this.dataFormat?(a=a.concat(t)).push(this.filters):(a.push(this.filters),a=a.concat(t)),a},e.prototype.getConfig=function(){var e={rank:this.rank,filters:this.filters,kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:wn(this.activation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),biasInitializer:on(this.biasInitializer),kernelRegularizer:Rn(this.kernelRegularizer),biasRegularizer:Rn(this.biasRegularizer),activityRegularizer:Rn(this.activityRegularizer),kernelConstraint:Oe(this.kernelConstraint),biasConstraint:Oe(this.biasConstraint)},t=i.prototype.getConfig.call(this);return Object.assign(e,t),e},e}(We),_n=function(t){function e(e){return t.call(this,2,e)||this}return l(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,e},e.className="Conv2D",e}(Pn);P.serialization.SerializationMap.register(_n);var Bn=function(n){function e(e){var t=n.call(this,e)||this;if(t.inputSpec=[new _e({ndim:4})],"same"!==t.padding&&"valid"!==t.padding)throw new oe("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+t.padding);return t}return l(e,n),e.prototype.build=function(e){if(4!==(e=h(e)).length)throw new oe("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new oe("The channel dimension of the inputs should be defined. Found `None`.");var n,i=e[t],r=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new _e({ndim:4,axes:(n={},n[t]=i,n)})],this.built=!0},e.prototype.call=function(d,e){var f=this;return P.tidy(function(){var e=v(d);if(4!==e.shape.length)throw new oe("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+e.shape.length);var t,n,i=e.shape,r=i[0];"channelsFirst"===f.dataFormat?(t=2,n=3):(t=1,n=2);var a=i[t],o=i[n],s=f.kernelSize[0],l=f.kernelSize[1],u=f.strides[0],c=f.strides[1],h=[r,En(a,u,s,f.padding),En(o,c,l,f.padding),f.filters];"channelsLast"!==f.dataFormat&&(e=P.transpose(e,[0,2,3,1]));var p=P.conv2dTranspose(e,f.kernel.read(),h,f.strides,f.padding);return"channelsLast"!==f.dataFormat&&(p=P.transpose(p,[0,3,1,2])),null!=f.bias&&(p=Ie(p,f.bias.read(),f.dataFormat)),null!=f.activation&&(p=f.activation.apply(p)),p})},e.prototype.computeOutputShape=function(e){var t,n,i,r=(e=h(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,i=3):(t=3,n=1,i=2);var a=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],l=this.strides[1];return r[t]=this.filters,r[n]=En(r[n],s,a,this.padding),r[i]=En(r[i],l,o,this.padding),r},e.prototype.getConfig=function(){var e=n.prototype.getConfig.call(this);return delete e.dilationRate,e},e.className="Conv2DTranspose",e}(_n);P.serialization.SerializationMap.register(Bn);var Un=function(t){function e(e){return t.call(this,2,e)||this}return l(e,t),e.className="SeparableConv2D",e}(function(i){function e(e,t){var n=i.call(this,e,t)||this;if(n.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",n.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",n.depthwiseKernel=null,(n.pointwiseKernel=null)==t.filters)throw new oe("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new oe("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new oe("SeparableConv"+n.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(t.padding));return n.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,n.depthwiseInitializer=sn(t.depthwiseInitializer||n.DEFAULT_DEPTHWISE_INITIALIZER),n.depthwiseRegularizer=Fn(t.depthwiseRegularizer),n.depthwiseConstraint=Ee(t.depthwiseConstraint),n.pointwiseInitializer=sn(t.depthwiseInitializer||n.DEFAULT_POINTWISE_INITIALIZER),n.pointwiseRegularizer=Fn(t.pointwiseRegularizer),n.pointwiseConstraint=Ee(t.pointwiseConstraint),n}return l(e,i),e.prototype.build=function(e){if((e=h(e)).length<this.rank+2)throw new oe("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new oe("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[t]));for(var n=e[t],i=this.kernelSize.concat([n,this.depthMultiplier]),r=[],a=0;a<this.rank;++a)r.push(1);r.push(n*this.depthMultiplier,this.filters);var o;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new _e({ndim:this.rank+2,axes:(o={},o[t]=n,o)})],this.built=!0},e.prototype.call=function(t,e){var n=this;return P.tidy(function(){var e;if(t=v(t),1===n.rank)throw new _("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(t=P.transpose(t,[0,2,3,1])),e=P.separableConv2d(t,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(e=Ie(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),"channelsFirst"===n.dataFormat&&(e=P.transpose(e,[0,3,1,2])),e})},e.prototype.getConfig=function(){var e=i.prototype.getConfig.call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=on(this.depthwiseInitializer),e.pointwiseInitializer=on(this.pointwiseInitializer),e.depthwiseRegularizer=Rn(this.depthwiseRegularizer),e.pointwiseRegularizer=Rn(this.pointwiseRegularizer),e.depthwiseConstraint=Oe(this.depthwiseConstraint),e.pointwiseConstraint=Oe(this.pointwiseConstraint),e},e.className="SeparableConv",e}(Pn));P.serialization.SerializationMap.register(Un);var jn=function(n){function e(e){var t=n.call(this,1,e)||this;return t.inputSpec=[{ndim:3}],t}return l(e,n),e.prototype.getConfig=function(){var e=n.prototype.getConfig.call(this);return delete e.rank,delete e.dataFormat,e},e.className="Conv1D",e}(Pn);P.serialization.SerializationMap.register(jn);var Wn=function(n){function e(e){var t=n.call(this,e)||this;return"number"==typeof e.cropping?t.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?t.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:t.cropping=e.cropping,t.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,t.inputSpec=[{ndim:4}],t}return l(e,n),e.prototype.computeOutputShape=function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]},e.prototype.call=function(e,t){var n=this;return P.tidy(function(){return e=v(e),"channelsLast"===n.dataFormat?pe(pe(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2),n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3):pe(pe(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3),n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)})},e.prototype.getConfig=function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Cropping2D",e}(We);P.serialization.SerializationMap.register(Wn);var Vn=function(n){function e(e){var t=n.call(this,e)||this;return t.DEFAULT_SIZE=[2,2],t.inputSpec=[{ndim:4}],t.size=void 0===e.size?t.DEFAULT_SIZE:e.size,t.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,t}return l(e,n),e.prototype.computeOutputShape=function(e){if("channelsFirst"===this.dataFormat){var t=this.size[0]*e[2],n=this.size[1]*e[3];return[e[0],e[1],t,n]}t=this.size[0]*e[1],n=this.size[1]*e[2];return[e[0],t,n,e[3]]},e.prototype.call=function(a,e){var o=this;return P.tidy(function(){var e=v(a),t=e.shape;if("channelsFirst"===o.dataFormat){e=P.transpose(e,[0,2,3,1]);var n=o.size[0]*t[2],i=o.size[1]*t[3],r=e.resizeNearestNeighbor([n,i]);return P.transpose(r,[0,3,1,2])}n=o.size[0]*t[1],i=o.size[1]*t[2];return e.resizeNearestNeighbor([n,i])})},e.prototype.getConfig=function(){var e={size:this.size,dataFormat:this.dataFormat},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="UpSampling2D",e}(We);P.serialization.SerializationMap.register(Vn);var qn=function(n){function e(e){var t=n.call(this,e)||this;return t.depthwiseKernel=null,t.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,t.depthwiseInitializer=sn(e.depthwiseInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.depthwiseConstraint=Ee(e.depthwiseConstraint),t.depthwiseRegularizer=Fn(e.depthwiseRegularizer),t}return l(e,n),e.prototype.build=function(e){if((e=h(e)).length<4)throw new oe("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(e)+".");var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new oe("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+e[t]+").");var n=e[t],i=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(s,e){var l=this;return P.tidy(function(){s=v(s);var t,n,i,r,a,o,e=(t=s,n=l.depthwiseKernel.read(),i=l.strides,r=l.padding,a=l.dataFormat,o=null,void 0===i&&(i=[1,1]),void 0===r&&(r="valid"),P.tidy(function(){null==a&&(a="channelsLast"),b(a);var e=xn(t,a);if(4!==t.rank)throw new oe("Input for depthwiseConv2d is required to be 4-D, but is instead "+t.rank+"-D");if(4!==n.rank)throw new oe("depthwiseKernel is required to be 4-D, but is instead "+n.rank+"-D");return e=P.depthwiseConv2d(e,n,i,"same"===r?"same":"valid","NHWC",o),"channelsFirst"===a&&(e=P.transpose(e,[0,3,1,2])),e}));return l.useBias&&(e=Ie(e,l.bias.read(),l.dataFormat)),null!=l.activation&&(e=l.activation.apply(e)),e})},e.prototype.computeOutputShape=function(e){e=h(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],i="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=Mn(t,this.kernelSize[0],this.padding,this.strides[0]),a=Mn(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],i,r,a]:[e[0],r,a,i]},e.className="DepthwiseConv2D",e}(_n);P.serialization.SerializationMap.register(qn);var Zn=function(n){function e(e){var t=n.call(this,e)||this;if(t.rate=Math.max(Math.min(e.rate,1),0),t.rateScalar=Y(t.rate),t.noiseShape=e.noiseShape,t.seed=e.seed,null!=t.seed)throw new _("Non-default seed is not implemented in Dropout layer yet: "+t.seed);return t.supportsMasking=!0,t}return l(e,n),e.prototype.getNoiseShape=function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],i=0;i<this.noiseShape.length;++i)n.push(null==this.noiseShape[i]?t[i]:this.noiseShape[i]);return n},e.prototype.call=function(r,s){var l=this;return P.tidy(function(){l.invokeCallHook(r,s);var e,t,n,a=v(r);if(null!=l.noiseShape&&!P.util.arraysEqual(a.shape,l.noiseShape))throw new _("Non-default noise shape is not implemented in Dropout layer yet: "+JSON.stringify(l.noiseShape));if(0<l.rate&&l.rate<1){var i=null!=s.training&&s.training,o=l.getNoiseShape(a);return e=function(){return t=a,n=l.rateScalar,i=o,r=l.seed,P.tidy(function(){if(null!=i&&!P.util.arraysEqual(t.shape,i))throw new _("Non-default noise shape is not implemented yet: "+JSON.stringify(i));if(null!=r)throw new _("seed is not implemented for dropout yet.");var e=P.step(P.add(P.neg(n),P.randomUniform(t.shape,0,1,"float32")));return e=P.mul(P.div(Y(1),P.sub(Y(1),n)),e),P.mul(t,e)});var t,n,i,r},t=function(){return a},void 0===(n=i)&&(n=!1),n?e():t()}return r})},e.prototype.getConfig=function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Dropout",e}(We);P.serialization.SerializationMap.register(Zn);var Kn=function(i){function e(e){var t=i.call(this,e)||this;if(t.activation=null,t.useBias=!0,t.kernel=null,t.bias=null,t.DEFAULT_KERNEL_INITIALIZER="glorotNormal",t.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var n=null;null!=e.batchSize&&(n=e.batchSize),t.batchInputShape=[n,e.inputDim]}return t.units=e.units,t.activation=In(e.activation),null!=e.useBias&&(t.useBias=e.useBias),t.kernelInitializer=sn(e.kernelInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.biasInitializer=sn(e.biasInitializer||t.DEFAULT_BIAS_INITIALIZER),t.kernelConstraint=Ee(e.kernelConstraint),t.biasConstraint=Ee(e.biasConstraint),t.kernelRegularizer=Fn(e.kernelRegularizer),t.biasRegularizer=Fn(e.biasRegularizer),t.activityRegularizer=Fn(e.activityRegularizer),t.inputSpec=[{minNDim:2}],t}return l(e,i),e.prototype.build=function(e){var t,n=(e=h(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(t={},t[-1]=n,t)}],this.built=!0},e.prototype.computeOutputShape=function(e){var t=(e=h(e)).slice();return t[t.length-1]=this.units,t},e.prototype.call=function(t,n){var i=this;return P.tidy(function(){i.invokeCallHook(t,n);var e=be(v(t),i.kernel.read());return null!=i.bias&&(e=Ie(e,i.bias.read())),null!=i.activation&&(e=i.activation.apply(e)),e})},e.prototype.getConfig=function(){var e={units:this.units,activation:wn(this.activation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),biasInitializer:on(this.biasInitializer),kernelRegularizer:Rn(this.kernelRegularizer),biasRegularizer:Rn(this.biasRegularizer),activityRegularizer:Rn(this.activityRegularizer),kernelConstraint:Oe(this.kernelConstraint),biasConstraint:Oe(this.biasConstraint)},t=i.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Dense",e}(We);P.serialization.SerializationMap.register(Kn);var Hn=function(n){function e(e){var t=n.call(this,e||{})||this;return t.inputSpec=[{minNDim:3}],t}return l(e,n),e.prototype.computeOutputShape=function(e){for(var t=0,n=(e=h(e)).slice(1);t<n.length;t++){if(null==n[t])throw new oe('The shape of the input to "Flatten" is not fully defined (got '+e.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.')}return[e[0],x(e,1)]},e.prototype.call=function(e,t){var n=this;return P.tidy(function(){return n.invokeCallHook(e,t),function(e){if(e.rank<=1)throw new oe("batchFlatten requires a minimum rank of 2. Got rank: "+e.rank+".");var t=[e.shape[0],x(e.shape,1)];return e.reshape(t)}(v(e))})},e.className="Flatten",e}(We);P.serialization.SerializationMap.register(Hn);var Gn=function(n){function e(e){var t=n.call(this,e)||this;return t.supportsMasking=!0,t.activation=In(e.activation),t}return l(e,n),e.prototype.call=function(t,n){var i=this;return P.tidy(function(){i.invokeCallHook(t,n);var e=v(t);return i.activation.apply(e)})},e.prototype.getConfig=function(){var e={activation:wn(this.activation)},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Activation",e}(We);P.serialization.SerializationMap.register(Gn);var Jn=function(n){function e(e){var t=n.call(this,e)||this;return t.n=e.n,t.inputSpec=[{ndim:2}],t}return l(e,n),e.prototype.computeOutputShape=function(e){return[e[0],this.n,e[1]]},e.prototype.call=function(n,e){var i=this;return P.tidy(function(){return n=v(n),e=n,t=i.n,P.tidy(function(){if(2!==e.shape.length)throw new oe("repeat() expects a rank-2 tensor, but received a rank-"+e.shape.length+" tensor.");return ge(re(e,1),[1,t,1])});var e,t})},e.prototype.getConfig=function(){var e={n:this.n},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="RepeatVector",e}(We);P.serialization.SerializationMap.register(Jn);var Xn=function(i){function e(e){var t=i.call(this,e)||this;t.targetShape=e.targetShape;for(var n=0;n<t.targetShape.length;++n)t.isUnknown(t.targetShape[n])&&(t.targetShape[n]=null);return t}return l(e,i),e.prototype.isUnknown=function(e){return e<0||null==e},e.prototype.fixUnknownDimension=function(e,t){for(var n="Total size of new array must be unchanged.",i=t.slice(),r=1,a=null,o=0;o<i.length;++o){var s=i[o];if(this.isUnknown(s)){if(null!==a)throw new oe("Can only specifiy one unknown dimension.");a=o}else r*=s}var l=x(e);if(null!==a){if(0===r||l%r!=0)throw new oe(n);i[a]=l/r}else if(l!==r)throw new oe(n);return i},e.prototype.computeOutputShape=function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))},e.prototype.call=function(i,r){var a=this;return P.tidy(function(){a.invokeCallHook(i,r);var e=v(i),t=ee(e),n=t.slice(0,1).concat(a.fixUnknownDimension(t.slice(1),a.targetShape));return e.reshape(n)})},e.prototype.getConfig=function(){var e={targetShape:this.targetShape},t=i.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Reshape",e}(We);P.serialization.SerializationMap.register(Xn);var $n=function(i){function e(e){var t=i.call(this,e)||this;if(t.embeddings=null,t.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var n=null;null!=e.batchSize&&(n=e.batchSize),null==e.inputLength?t.batchInputShape=[n,null]:t.batchInputShape=[n].concat(E(e.inputLength))}return t.inputDim=e.inputDim,t.outputDim=e.outputDim,t.embeddingsInitializer=sn(e.embeddingsInitializer||t.DEFAULT_EMBEDDINGS_INITIALIZER),t.embeddingsRegularizer=Fn(e.embeddingsRegularizer),t.activityRegularizer=Fn(e.activityRegularizer),t.embeddingsConstraint=Ee(e.embeddingsConstraint),t.maskZero=e.maskZero,t.inputLength=e.inputLength,t}return l(e,i),e.prototype.build=function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.computeMask=function(e,t){throw new _("computeMask has not been implemented for Embedding yet")},e.prototype.computeOutputShape=function(e){if(e=h(e),null==this.inputLength)return e.concat([this.outputDim]);var t=E(this.inputLength);if(t.length!==e.length-1)throw new oe('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);for(var n=0,i=0;i<t.length;++i){var r=t[i],a=e[i+1];if(null!=r&&null!=a&&r!==a)throw new oe('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);null==r&&(t[n]=a),n++}return[e[0]].concat(t,[this.outputDim])},e.prototype.call=function(t,n){var i=this;return P.tidy(function(){i.invokeCallHook(t,n);var e=v(t);return"int32"!==ne(e)&&(e=ie(e,"int32")),we(i.embeddings.read(),e.as1D()).reshape(h(i.computeOutputShape(e.shape)))})},e.prototype.getConfig=function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:on(this.embeddingsInitializer),embeddingsRegularizer:Rn(this.embeddingsRegularizer),activityRegularizer:Rn(this.activityRegularizer),embeddingsConstraint:Oe(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=i.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Embedding",e}(We);P.serialization.SerializationMap.register($n);var Yn=function(n){function e(e){var t=n.call(this,e||{})||this;return t.supportsMasking=!0,t}return l(e,n),e.prototype.mergeFunction=function(e){throw new _},e.prototype.computeElementwiseOpOutputShape=function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),i=0;i<t.length;++i){var r=e[e.length-t.length+i],a=t[i];if(null==r||null==a||r<0||a<0)n.push(null);else if(1===r)n.push(a);else if(1===a)n.push(r);else{if(r!==a)throw new oe("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(r)}}return n},e.prototype.build=function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[h(e)]),(e=e).length<2)throw new oe("A merge layer should be called on an Array of at least 2 inputs. Got "+e.length+" input(s).");for(var t=[],n=0,i=e;n<i.length;n++){null!=(o=i[n])&&null!==o[0]&&t.push(o[0])}if(1<(t=ue(t)).length)throw new oe("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(e)+".");for(var r=null==e[0]?null:e[0].slice(1),a=1;a<e.length;++a){var o=null==e[a]?null:e[a].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}var s=e.map(function(e){return e.length});-1===e.indexOf(null)&&1===ue(s).length?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(b,e){var w=this;return P.tidy(function(){if(b=b,w.reshapeRequired){var e=[],t=b.map(function(e){return e.rank});if(-1===t.indexOf(null)){for(var n=j(t),i=0,r=b;i<r.length;i++){for(var a=(c=r[i]).rank,o=0;o<n-a;++o)c=re(c,1);e.push(c)}return w.mergeFunction(e)}for(var s=!1,l=0,u=b;l<u.length;l++){var c;if(null==(a=(c=u[l]).rank)){var h=ee(c),p=h[0],d=h.slice(1).concat([p]),f=c.reshape([p].concat(x(h.slice(1))));f=(f=P.transpose(f,[1,0])).reshape(d),e.push(f),s=!0}else if(1<a){var g=W(1,a).concat([0]);e.push(P.transpose(c,g)),s=!0}else e.push(c)}var m=w.mergeFunction(e),y=m.rank;if(s)if(null==y){var v=ee(m);d=[p=v[v.length-1]].concat(v.slice(0,v.length-1));m=P.transpose(m.reshape([-1,p]),[1,0]).reshape(d)}else if(1<y){g=[y-1].concat(W(0,y-1));m=P.transpose(m,g)}return m}return w.mergeFunction(b)})},e.prototype.computeOutputShape=function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var i=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}for(var r=[],a=0,o=e;a<o.length;a++){null!=(i=o[a])&&null!==i[0]&&r.push(i[0])}return t=1===(r=ue(r)).length?r.concat(t):[null].concat(t)},e}(We),Qn=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.mergeFunction=function(r){return P.tidy(function(){for(var e=P.zeros(r[0].shape),t=0,n=r;t<n.length;t++){var i=n[t];e=P.add(e,i)}return e})},e.className="Add",e}(Yn);P.serialization.SerializationMap.register(Qn);var ei=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.mergeFunction=function(r){return P.tidy(function(){for(var e=P.ones(r[0].shape),t=0,n=r;t<n.length;t++){var i=n[t];e=P.mul(e,i)}return e})},e.className="Multiply",e}(Yn);P.serialization.SerializationMap.register(ei);var ti=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.mergeFunction=function(r){return P.tidy(function(){for(var e=P.zeros(r[0].shape),t=0,n=r;t<n.length;t++){var i=n[t];e=P.add(e,i)}return me(Y(1/r.length),e)})},e.className="Average",e}(Yn);P.serialization.SerializationMap.register(ti);var ni=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.mergeFunction=function(n){return P.tidy(function(){for(var e=n[0],t=1;t<n.length;++t)e=P.maximum(e,n[t]);return e})},e.className="Maximum",e}(Yn);P.serialization.SerializationMap.register(ni);var ii=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.mergeFunction=function(n){return P.tidy(function(){for(var e=n[0],t=1;t<n.length;++t)e=P.minimum(e,n[t]);return e})},e.className="Minimum",e}(Yn);P.serialization.SerializationMap.register(ii);var ri=function(n){function e(e){var t=n.call(this,e)||this;return t.DEFAULT_AXIS=-1,null==e&&(e={}),t.axis=null==e.axis?t.DEFAULT_AXIS:e.axis,t.supportsMasking=!0,t.reshapeRequired=!1,t}return l(e,n),e.prototype.build=function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new oe("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var t=!0,n=0,i=e=e;n<i.length;n++){if(null!=(c=i[n])){t=!1;break}}if(!t){for(var r=[],a=0;a<e.length;++a){var o=e[a].slice();o.splice(this.axis,1);for(var s=!1,l=0,u=r;l<u.length;l++){var c=u[l];if(P.util.arraysEqual(c,o)){s=!0;break}}s||r.push(o)}if(1<r.length)throw new oe("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}},e.prototype.mergeFunction=function(e){var t=this;return P.tidy(function(){return de(e,t.axis)})},e.prototype.computeOutputShape=function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new oe("A `Concatenate` layer should be called on a list of inputs.");for(var t=e,n=t[0].slice(),i=this.axis<0?n.length+this.axis:this.axis,r=0,a=t.slice(1);r<a.length;r++){var o=a[r];if(null==n[i]||null==o[i]){n[i]=null;break}n[i]+=o[i]}return n},e.prototype.getConfig=function(){var e={axis:this.axis},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Concatenate",e}(Yn);function ai(e,t,n,i,r,a){var o;if(void 0===a&&(a=.001),2===e.rank)o=P.batchNormalization2d(e,t,n,a,r,i);else if(3===e.rank)o=P.batchNormalization3d(e,t,n,a,r,i);else{if(4!==e.rank)throw new _("batchNormalization is not implememnted for array of rank "+e.rank+" yet");o=P.batchNormalization4d(e,t,n,a,r,i)}return o}function oi(e,t,n,i,r){return void 0===r&&(r=.001),P.util.arraysEqual(i.slice().sort(),W(0,e.rank-1))?(a=e,o=t,s=n,l=i,void 0===(u=r)&&(u=.001),P.tidy(function(){var e=P.moments(a,l),t=e.mean,n=e.variance;return[ai(a,t,n,s,o,u),t,n]})):(h=e,p=t,d=n,f=i,void 0===(g=r)&&(g=.001),P.tidy(function(){for(var e=P.moments(h,f),t=e.mean,n=e.variance,i=[],r=0,a=W(0,h.rank);r<a.length;r++){var o=a[r];-1!==f.indexOf(o)?i.push(1):i.push(h.shape[o])}var s=t.reshape(i),l=n.reshape(i),u=null==p?null:p.reshape(i),c=null==d?null:d.reshape(i);return[ai(h,s,l,c,u,g),t,n]}));var h,p,d,f,g,a,o,s,l,u}P.serialization.SerializationMap.register(ri);var si=function(n){function e(e){var t=n.call(this,e)||this;return t.supportsMasking=!0,t.axis=null==e.axis?-1:e.axis,t.momentum=null==e.momentum?.99:e.momentum,t.epsilon=null==e.epsilon?.001:e.epsilon,t.center=null==e.center||e.center,t.scale=null==e.scale||e.scale,t.betaInitializer=sn(e.betaInitializer||"zeros"),t.gammaInitializer=sn(e.gammaInitializer||"ones"),t.movingMeanInitializer=sn(e.movingMeanInitializer||"zeros"),t.movingVarianceInitializer=sn(e.movingVarianceInitializer||"ones"),t.betaConstraint=Ee(e.betaConstraint),t.gammaConstraint=Ee(e.gammaConstraint),t.betaRegularizer=Fn(e.betaRegularizer),t.gammaRegularizer=Fn(e.gammaRegularizer),t.stepCount=0,t}return l(e,n),e.prototype.build=function(e){e=h(e);var t=0<=this.axis?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new oe("Axis "+t+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(e)+".");this.inputSpec=[new _e({ndim:e.length,axes:(i={},i[t]=n,i)})];var i,r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(g,m){var y=this;return P.tidy(function(){var e=null!=m.training&&m.training,r=v(g),t=ee(r),n=t.length,i=W(0,n),a=0<=y.axis?y.axis:y.axis+n;i.splice(a,1);var o=M(1,n);o[a]=t[a];var s=i.slice();s.sort();var l=!P.util.arraysEqual(s,W(0,n).slice(0,n-1));if(!e)return function(){if(l){var e=y.movingMean.read().reshape(o),t=y.movingVariance.read().reshape(o),n=y.center?y.beta.read().reshape(o):null,i=y.scale?y.gamma.read().reshape(o):null;return ai(r,e,t,n,i,y.epsilon)}return ai(r,y.movingMean.read(),y.movingVariance.read(),null==y.beta?null:y.beta.read(),null==y.gamma?null:y.gamma.read(),y.epsilon)}();var u=oi(r,y.gamma.read(),y.beta.read(),i,y.epsilon),c=u[0],h=u[1],p=u[2],d=x(i.map(function(e){return r.shape[e]})),f=p.mul(Y(d/(d-(1+y.epsilon))));return function(){y.stepCount++;var e=P.movingAverage(y.movingMean.read(),h,y.momentum,y.stepCount);y.movingMean.write(e);var t=P.movingAverage(y.movingVariance.read(),f,y.momentum,y.stepCount);y.movingVariance.write(t)}(),c})},e.prototype.getConfig=function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:on(this.betaInitializer),gammaInitializer:on(this.gammaInitializer),movingMeanInitializer:on(this.movingMeanInitializer),movingVarianceInitializer:on(this.movingVarianceInitializer),betaRegularizer:Rn(this.betaRegularizer),gammaRegularizer:Rn(this.gammaRegularizer),betaConstraint:Oe(this.betaConstraint),gammaConstraint:Oe(this.gammaConstraint)},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="BatchNormalization",e}(We);P.serialization.SerializationMap.register(si);var li=function(r){function e(e){var t=this;if(null==e&&(e={}),(t=r.call(this,e)||this).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)t.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)t.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new oe("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+e.padding.length+" array.");var n=void 0,i=void 0;if("number"==typeof e.padding[0])n=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new oe("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+e.padding[0].length+" array.");if(n=e.padding[0],2!==e.padding[1].length)throw new oe("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+e.padding[1].length+" array.");i=e.padding[1]}t.padding=[n,i]}return t.inputSpec=[new _e({ndim:4})],t}return l(e,r),e.prototype.computeOutputShape=function(e){var t,n;return e=h(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&0<=e[2]?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&0<=e[3]?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&0<=e[1]?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&0<=e[2]?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])},e.prototype.call=function(e,t){var r=this;return P.tidy(function(){return t=v(e),n=r.padding,i=r.dataFormat,P.tidy(function(){if(4!==t.rank)throw new oe("temporalPadding expects input tensor to be 4-D, but received a "+t.rank+"-D tensor.");if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new oe("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==i&&(i="channelsLast"),"channelsLast"!==i&&"channelsFirst"!==i)throw new oe("Unknown data format: "+i+". Supported data formats are 'channelsLast' and 'channelsFirst.");var e;return e="channelsFirst"===i?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],P.pad(t,e)});var t,n,i})},e.prototype.getConfig=function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=r.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="ZeroPadding2D",e}(We);function ui(n,i,r,a,o,s){return P.tidy(function(){var e;b(o),p(z,"PoolMode",s),w(a),null==r&&(r=[1,1]),null==a&&(a="valid"),null==o&&(o="channelsLast"),null==s&&(s="max"),n=xn(n,o);var t="same"===a?"same":"valid";return e="max"===s?P.maxPool(n,i,r,t):P.avgPool(n,i,r,t),"channelsFirst"===o&&(e=P.transpose(e,[0,3,1,2])),e})}P.serialization.SerializationMap.register(li);var ci=function(n){function e(e){var t=this;if(null==e.poolSize&&(e.poolSize=2),t=n.call(this,e)||this,"number"==typeof e.poolSize)t.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new oe("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));t.poolSize=e.poolSize}if(null==e.strides)t.strides=t.poolSize;else if("number"==typeof e.strides)t.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new oe("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));t.strides=e.strides}return t.padding=null==e.padding?"valid":e.padding,w(t.padding),t.inputSpec=[new _e({ndim:3})],t}return l(e,n),e.prototype.computeOutputShape=function(e){var t=Mn((e=h(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]},e.prototype.call=function(t,n){var i=this;return P.tidy(function(){i.invokeCallHook(t,n),t=re(v(t),2);var e=i.poolingFunction(v(t),[i.poolSize[0],1],[i.strides[0],1],i.padding,"channelsLast");return P.squeeze(e,[2])})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e}(We),hi=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.poolingFunction=function(e,t,n,i,r){return b(r),w(i),ui(e,t,n,i,r,"max")},e.className="MaxPooling1D",e}(ci);P.serialization.SerializationMap.register(hi);var pi=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.poolingFunction=function(e,t,n,i,r){return b(r),w(i),ui(e,t,n,i,r,"avg")},e.className="AveragePooling1D",e}(ci);P.serialization.SerializationMap.register(pi);var di=function(n){function e(e){var t=this;return null==e.poolSize&&(e.poolSize=[2,2]),(t=n.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],t.strides=null==e.strides?t.poolSize:e.strides,t.padding=null==e.padding?"valid":e.padding,t.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,b(t.dataFormat),w(t.padding),t.inputSpec=[new _e({ndim:4})],t}return l(e,n),e.prototype.computeOutputShape=function(e){e=h(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=Mn(t,this.poolSize[0],this.padding,this.strides[0]),n=Mn(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]},e.prototype.call=function(e,t){var n=this;return P.tidy(function(){return n.invokeCallHook(e,t),n.poolingFunction(v(e),n.poolSize,n.strides,n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e}(We),fi=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.poolingFunction=function(e,t,n,i,r){return b(r),w(i),ui(e,t,n,i,r,"max")},e.className="MaxPooling2D",e}(di);P.serialization.SerializationMap.register(fi);var gi=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.poolingFunction=function(e,t,n,i,r){return b(r),w(i),ui(e,t,n,i,r,"avg")},e.className="AveragePooling2D",e}(di);P.serialization.SerializationMap.register(gi);var mi=function(n){function e(e){var t=n.call(this,e)||this;return t.inputSpec=[new _e({ndim:3})],t}return l(e,n),e.prototype.computeOutputShape=function(e){return[e[0],e[2]]},e.prototype.call=function(e,t){throw new _},e}(We),yi=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.call=function(t,e){return P.tidy(function(){var e=v(t);return P.mean(e,1)})},e.className="GlobalAveragePooling1D",e}(mi);P.serialization.SerializationMap.register(yi);var vi=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.call=function(t,e){return P.tidy(function(){var e=v(t);return P.max(e,1)})},e.className="GlobalMaxPooling1D",e}(mi);P.serialization.SerializationMap.register(vi);var bi=function(n){function e(e){var t=n.call(this,e)||this;return t.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,b(t.dataFormat),t.inputSpec=[new _e({ndim:4})],t}return l(e,n),e.prototype.computeOutputShape=function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]},e.prototype.call=function(e,t){throw new _},e.prototype.getConfig=function(){var e={dataFormat:this.dataFormat},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e}(We),wi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.call=function(t,e){var n=this;return P.tidy(function(){var e=v(t);return"channelsLast"===n.dataFormat?P.mean(e,[1,2]):P.mean(e,[2,3])})},t.className="GlobalAveragePooling2D",t}(bi);P.serialization.SerializationMap.register(wi);var zi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.call=function(t,e){var n=this;return P.tidy(function(){var e=v(t);return"channelsLast"===n.dataFormat?P.max(e,[1,2]):P.max(e,[2,3])})},t.className="GlobalMaxPooling2D",t}(bi);function Ii(e,t,n,i,r,a,o,s){void 0===i&&(i=!1),void 0===o&&(o=!1);var l=t.shape.length;if(l<3)throw new oe("Input should be at least 3D, but is "+l+"D.");var u,c,h=[1,0].concat(W(2,l));if(t=P.transpose(t,h),null!=r)throw new _("The rnn() function of the deeplearn.js backend does not support masking yet.");if(null!=a)throw new _("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i&&(t=P.reverse(t,0));for(var p=n,d=t.shape[0],f=0;f<d;++f){var g=ce(t,f,1),m=e(g=g.reshape(g.shape.slice(1)),p);c=m[0],u=0===f?c.reshape([1].concat(c.shape)):fe(u,c.reshape([1].concat(c.shape))),p=m[1]}return[c,P.transpose(u,[1,0].concat(W(2,u.shape.length))),p]}P.serialization.SerializationMap.register(zi);var Si=function(f){function e(e){var t,n=f.call(this,e)||this;if(null==e.cell)throw new oe("cell property is missing for the constructor of RNN.");if(null==(t=Array.isArray(e.cell)?new Di({cells:e.cell}):e.cell).stateSize)throw new oe("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return n.cell=t,n.returnSequences=null!=e.returnSequences&&e.returnSequences,n.returnState=null!=e.returnState&&e.returnState,n.goBackwards=null!=e.goBackwards&&e.goBackwards,n._stateful=null!=e.stateful&&e.stateful,n.unroll=null!=e.unroll&&e.unroll,n.supportsMasking=!0,n.inputSpec=[new _e({ndim:3})],n.stateSpec=null,n.states=null,n.numConstants=null,n}return l(e,f),e.prototype.getStates=function(){return null==this.states?W(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(e){return null}):this.states},e.prototype.setStates=function(e){this.states=e},e.prototype.computeOutputShape=function(e){c(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,i=t[0];if(n=this.returnSequences?[e[0],e[1],i]:[e[0],i],this.returnState){for(var r=[],a=0,o=t;a<o.length;a++){var s=o[a];r.push([e[0],s])}return[n].concat(r)}return n},e.prototype.computeMask=function(e,t){throw new _("computeMask has not been implemented for RNN yet")},e.prototype.build=function(e){if(null!=this.numConstants)throw new _("Constants support is not implemented in RNN yet.");c(e)&&(e=e[0]),e=e;var t=this.stateful?e[0]:null,n=e[e.length-1];this.inputSpec[0]=new _e({shape:[t,null,n]});var i,r=[e[0]].concat(e.slice(2));if(this.cell.build(r),i=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!P.util.arraysEqual(this.stateSpec.map(function(e){return e.shape[e.shape.length-1]}),i))throw new oe("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=i.map(function(e){return new _e({shape:[null,e]})});if(this.stateful)throw new _("stateful RNN layer is not implemented yet")},e.prototype.resetStates=function(a){var o=this;P.tidy(function(){if(!o.stateful)throw new u("Cannot call resetState() on an RNN Layer that is not stateful.");var t=o.inputSpec[0].shape[0];if(null==t)throw new oe("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==o.states)Array.isArray(o.cell.stateSize)?o.states=o.cell.stateSize.map(function(e){return P.zeros([t,e])}):o.states=[P.zeros([t,o.cell.stateSize])];else if(null==a)Array.isArray(o.cell.stateSize)?o.states=o.cell.stateSize.map(function(e){return P.zeros([t,e])}):o.states[0]=P.zeros([t,o.cell.stateSize]);else{if(Array.isArray(a)||(a=[a]),a.length!==o.states.length)throw new oe("Layer "+o.name+" expects "+o.states.length+" state(s), but it received "+a.length+" state value(s). Input received: "+a);for(var e=0;e<o.states.length;++e){var n=a[e],i=Array.isArray(o.cell.stateSize)?o.cell.stateSize[e]:o.cell.stateSize,r=[t,i];if(!P.util.arraysEqual(n.shape,r))throw new oe("State "+e+" is incompatible with layer "+o.name+": expected shape="+r+", received shape="+n.shape);o.states[e]=n}}})},e.prototype.standardizeArgs=function(e,t,n){if(Array.isArray(e)){if(null!=t||null!=n)throw new oe("When inputs is an array, neither initialState or constants should be provided");null!=this.numConstants&&(n=e.slice(e.length-this.numConstants,e.length),e=e.slice(0,e.length-this.numConstants)),1<e.length&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}},e.prototype.apply=function(e,t){var n=null==t?null:t.initialState,i=null==t?null:t.constants;null==t&&(t={});var r=this.standardizeArgs(e,n,i);e=r.inputs,n=r.initialState,i=r.constants;var a=[],o=[];if(null!=n){t.initialState=n,a=a.concat(n),this.stateSpec=[];for(var s=0,l=n;s<l.length;s++){var u=l[s];this.stateSpec.push(new _e({shape:u.shape}))}o=o.concat(this.stateSpec)}if(null!=i&&(t.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof Z){var c=[e].concat(a),h=this.inputSpec.concat(o),p=this.inputSpec;this.inputSpec=h;var d=f.prototype.apply.call(this,c,t);return this.inputSpec=p,d}return f.prototype.apply.call(this,e,t)},e.prototype.call=function(c,h){var p=this;return P.tidy(function(){var e=null==h?null:h.mask,t=null==h?null:h.training,n=null==h?null:h.initialState;if(c=v(c),null==n){if(p.stateful)throw new _("stateful RNN layer is not implemented yet.");n=p.getInitialState(c)}if(null!=e)throw new _("Masking is not implemented for RNN yet");var i=Array.isArray(p.cell.stateSize)?p.cell.stateSize.length:1;if(n.length!==i)throw new oe("RNN Layer has "+i+" state(s) but was passed "+n.length+" initial state(s).");c.shape[1];p.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var r={training:t},a=Ii(function(e,t){var n=p.cell.call([e].concat(t),r);return[n[0],n.slice(1)]},c,n,p.goBackwards,null,null,p.unroll),o=a[0],s=a[1],l=a[2];if(p.stateful)throw new _("stateful RNN layer is not implemented yet");var u=p.returnSequences?s:o;return p.returnState?[u].concat(l):u})},e.prototype.getInitialState=function(e){var n=this;return P.tidy(function(){var t=P.zeros(e.shape);return t=re(t=P.sum(t,[1,2])),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(e){return 1<e?ge(t,[1,e]):t}):1<n.cell.stateSize?[ge(t,[1,n.cell.stateSize])]:[t]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);var t=this.cell.getConfig();e.cell={className:this.cell.getClassName(),config:t};var n=f.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="RNN",e}(We);P.serialization.SerializationMap.register(Si);var Ni=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t=n([P.doc({heading:"Layers",subheading:"Classes"})],t)}(We),ki=function(n){function e(e){var t=n.call(this,e)||this;return t.DEFAULT_ACTIVATION="tanh",t.DEFAULT_KERNEL_INITIALIZER="glorotNormal",t.DEFAULT_RECURRENT_INITIALIZER="orthogonal",t.DEFAULT_BIAS_INITIALIZER="zeros",t.units=e.units,t.activation=In(null==e.activation?t.DEFAULT_ACTIVATION:e.activation),t.useBias=null==e.useBias||e.useBias,t.kernelInitializer=sn(e.kernelInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.recurrentInitializer=sn(e.recurrentInitializer||t.DEFAULT_RECURRENT_INITIALIZER),t.biasInitializer=sn(e.biasInitializer||t.DEFAULT_BIAS_INITIALIZER),t.kernelRegularizer=Fn(e.kernelRegularizer),t.recurrentRegularizer=Fn(e.recurrentRegularizer),t.biasRegularizer=Fn(e.biasRegularizer),t.kernelConstraint=Ee(e.kernelConstraint),t.recurrentConstraint=Ee(e.recurrentConstraint),t.biasConstraint=Ee(e.biasConstraint),t.dropout=U([1,j([0,null==e.dropout?0:e.dropout])]),t.recurrentDropout=U([1,j([0,null==e.recurrentDropout?0:e.recurrentDropout])]),t.stateSize=t.units,t}return l(e,n),e.prototype.build=function(e){e=h(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(i,e){var r=this;return P.tidy(function(){if(2!==(i=i).length)throw new oe("SimpleRNNCell expects 2 input Tensors, got "+i.length+".");var e=i[1];if(i=i[0],0!==r.dropout||0!==r.recurrentDropout)throw new _("Dropout is not implemented for SimpleRNNCell yet");var t=be(i,r.kernel.read());null!=r.bias&&(t=Ie(t,r.bias.read()));var n=P.add(t,be(e,r.recurrentKernel.read()));return null!=r.activation&&(n=r.activation.apply(n)),[n,n]})},e.prototype.getConfig=function(){var e={units:this.units,activation:wn(this.activation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),recurrentInitializer:on(this.recurrentInitializer),biasInitializer:on(this.biasInitializer),kernelRegularizer:Rn(this.kernelRegularizer),recurrentRegularizer:Rn(this.recurrentRegularizer),biasRegularizer:Rn(this.biasRegularizer),activityRegularizer:Rn(this.activityRegularizer),kernelConstraint:Oe(this.kernelConstraint),recurrentConstraint:Oe(this.recurrentConstraint),biasConstraint:Oe(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="SimpleRNNCell",e}(Ni);P.serialization.SerializationMap.register(ki);var Ci=function(o){function e(e){return e.cell=new ki(e),o.call(this,e)||this}return l(e,o),e.prototype.call=function(i,r){var a=this;return P.tidy(function(){var e=null==r?null:r.mask,t=null==r?null:r.training,n=null==r?null:r.initialState;return o.prototype.call.call(a,i,{mask:e,training:t,initialState:n})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:wn(this.activation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),recurrentInitializer:on(this.recurrentInitializer),biasInitializer:on(this.biasInitializer),kernelRegularizer:Rn(this.kernelRegularizer),recurrentRegularizer:Rn(this.recurrentRegularizer),biasRegularizer:Rn(this.biasRegularizer),activityRegularizer:Rn(this.activityRegularizer),kernelConstraint:Oe(this.kernelConstraint),recurrentConstraint:Oe(this.recurrentConstraint),biasConstraint:Oe(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},t=o.prototype.getConfig.call(this);return delete t.cell,Object.assign(e,t),e},e.className="SimpleRNN",e}(Si);P.serialization.SerializationMap.register(Ci);var Li=function(n){function e(e){var t=n.call(this,e)||this;return t.DEFAULT_ACTIVATION="tanh",t.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",t.DEFAULT_KERNEL_INITIALIZER="glorotNormal",t.DEFAULT_RECURRENT_INITIALIZER="orthogonal",t.DEFAULT_BIAS_INITIALIZER="zeros",t.units=e.units,t.activation=In(void 0===e.activation?t.DEFAULT_ACTIVATION:e.activation),t.recurrentActivation=In(void 0===e.activation?t.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),t.useBias=null==e.useBias||e.useBias,t.kernelInitializer=sn(e.kernelInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.recurrentInitializer=sn(e.recurrentInitializer||t.DEFAULT_RECURRENT_INITIALIZER),t.biasInitializer=sn(e.biasInitializer||t.DEFAULT_BIAS_INITIALIZER),t.kernelRegularizer=Fn(e.kernelRegularizer),t.recurrentRegularizer=Fn(e.recurrentRegularizer),t.biasRegularizer=Fn(e.biasRegularizer),t.kernelConstraint=Ee(e.kernelConstraint),t.recurrentConstraint=Ee(e.recurrentConstraint),t.biasConstraint=Ee(e.biasConstraint),t.dropout=U([1,j([0,null==e.dropout?0:e.dropout])]),t.recurrentDropout=U([1,j([0,null==e.recurrentDropout?0:e.recurrentDropout])]),t.implementation=e.implementation,t.stateSize=t.units,t}return l(e,n),e.prototype.build=function(e){var t=(e=h(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(L,e){var A=this;return P.tidy(function(){if(0!==A.dropout||0!==A.recurrentDropout)throw new _("Dropout is not implemented for GRUCell yet");if(2!==(L=L).length)throw new oe("GRUCell expects 2 input Tensors (inputs, h, c), got "+L.length+".");var e,t,n,i=L[1];if(L=L[0],1===A.implementation){var r=he(A.kernel.read(),0,A.units),a=he(A.kernel.read(),A.units,A.units),o=he(A.kernel.read(),2*A.units,A.units),s=he(A.recurrentKernel.read(),0,A.units),l=he(A.recurrentKernel.read(),A.units,A.units),u=he(A.recurrentKernel.read(),2*A.units,A.units),c=L,h=L,p=be(L,r),d=be(c,a),f=be(h,o);if(A.useBias){var g=ce(A.bias.read(),0,A.units),m=ce(A.bias.read(),A.units,A.units),y=ce(A.bias.read(),2*A.units,A.units);p=Ie(p,g),d=Ie(d,m),f=Ie(f,y)}var v=i,b=i,w=i;e=A.recurrentActivation.apply(P.add(p,be(v,s))),t=A.recurrentActivation.apply(P.add(d,be(b,l))),n=A.activation.apply(P.add(f,be(P.mul(t,w),u)))}else{var z=be(L,A.kernel.read());A.useBias&&(z=Ie(z,A.bias.read()));var I=be(i,he(A.recurrentKernel.read(),0,2*A.units)),S=(p=he(z,0,A.units),d=he(z,A.units,A.units),he(I,0,A.units)),N=he(I,A.units,A.units);e=A.recurrentActivation.apply(P.add(p,S)),t=A.recurrentActivation.apply(P.add(d,N));f=he(z,2*A.units,A.units);var k=be(P.mul(t,i),he(A.recurrentKernel.read(),2*A.units,A.units));n=A.activation.apply(P.add(f,k))}var C=P.add(P.mul(e,i),P.mul(ye(Y(1),P.neg(e)),n));return[C,C]})},e.prototype.getConfig=function(){var e={units:this.units,activation:wn(this.activation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),recurrentInitializer:on(this.recurrentInitializer),biasInitializer:on(this.biasInitializer),kernelRegularizer:Rn(this.kernelRegularizer),recurrentRegularizer:Rn(this.recurrentRegularizer),biasRegularizer:Rn(this.biasRegularizer),activityRegularizer:Rn(this.activityRegularizer),kernelConstraint:Oe(this.kernelConstraint),recurrentConstraint:Oe(this.recurrentConstraint),biasConstraint:Oe(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="GRUCell",e}(Ni);P.serialization.SerializationMap.register(Li);var Ai=function(o){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Li(e),o.call(this,e)||this}return l(e,o),e.prototype.call=function(i,r){var a=this;return P.tidy(function(){var e=null==r?null:r.mask,t=null==r?null:r.training,n=null==r?null:r.initialState;return o.prototype.call.call(a,i,{mask:e,training:t,initialState:n})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:wn(this.activation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),recurrentInitializer:on(this.recurrentInitializer),biasInitializer:on(this.biasInitializer),kernelRegularizer:Rn(this.kernelRegularizer),recurrentRegularizer:Rn(this.recurrentRegularizer),biasRegularizer:Rn(this.biasRegularizer),activityRegularizer:Rn(this.activityRegularizer),kernelConstraint:Oe(this.kernelConstraint),recurrentConstraint:Oe(this.recurrentConstraint),biasConstraint:Oe(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=o.prototype.getConfig.call(this);return delete t.cell,Object.assign(e,t),e},e.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},e.className="GRU",e}(Si);P.serialization.SerializationMap.register(Ai);var Ti=function(n){function e(e){var t=n.call(this,e)||this;return t.DEFAULT_ACTIVATION="tanh",t.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",t.DEFAULT_KERNEL_INITIALIZER="glorotNormal",t.DEFAULT_RECURRENT_INITIALIZER="orthogonal",t.DEFAULT_BIAS_INITIALIZER="zeros",t.units=e.units,t.activation=In(void 0===e.activation?t.DEFAULT_ACTIVATION:e.activation),t.recurrentActivation=In(void 0===e.activation?t.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),t.useBias=null==e.useBias||e.useBias,t.kernelInitializer=sn(e.kernelInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.recurrentInitializer=sn(e.recurrentInitializer||t.DEFAULT_RECURRENT_INITIALIZER),t.biasInitializer=sn(e.biasInitializer||t.DEFAULT_BIAS_INITIALIZER),t.unitForgetBias=e.unitForgetBias,t.kernelRegularizer=Fn(e.kernelRegularizer),t.recurrentRegularizer=Fn(e.recurrentRegularizer),t.biasRegularizer=Fn(e.biasRegularizer),t.kernelConstraint=Ee(e.kernelConstraint),t.recurrentConstraint=Ee(e.recurrentConstraint),t.biasConstraint=Ee(e.biasConstraint),t.dropout=U([1,j([0,null==e.dropout?0:e.dropout])]),t.recurrentDropout=U([1,j([0,null==e.recurrentDropout?0:e.recurrentDropout])]),t.implementation=e.implementation,t.stateSize=[t.units,t.units],t}return l(e,n),e.prototype.build=function(e){var t,n,i=(e=h(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[i,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,o=this.units;(n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.apply=function(e,t){var n=a.apply([o]),i=(new Zt).apply([o]),r=a.apply([2*o]);return fe(fe(n,i),r)},t}(Vt)).className="CustomInit",t=new n}else t=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,t,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(E,e){var x=this;return P.tidy(function(){if(0!==x.dropout||0!==x.recurrentDropout)throw new _("Dropout is not implemented for LSTMCell yet");if(3!==(E=E).length)throw new oe("LSTMCell expects 3 input Tensors (inputs, h, c), got "+E.length+".");var e,t,n,i,r=E[1],a=E[2];if(E=E[0],1===x.implementation){var o=he(x.kernel.read(),0,x.units),s=he(x.kernel.read(),x.units,x.units),l=he(x.kernel.read(),2*x.units,x.units),u=he(x.kernel.read(),3*x.units,x.units),c=he(x.recurrentKernel.read(),0,x.units),h=he(x.recurrentKernel.read(),x.units,x.units),p=he(x.recurrentKernel.read(),2*x.units,x.units),d=he(x.recurrentKernel.read(),3*x.units,x.units),f=E,g=E,m=E,y=be(E,o),v=be(f,s),b=be(g,l),w=be(m,u);if(x.useBias){var z=ce(x.bias.read(),0,x.units),I=ce(x.bias.read(),x.units,x.units),S=ce(x.bias.read(),2*x.units,x.units),N=ce(x.bias.read(),3*x.units,x.units);y=Ie(y,z),v=Ie(v,I),b=Ie(b,S),w=Ie(w,N)}var k=r,C=r,L=r,A=r;e=x.recurrentActivation.apply(P.add(y,be(k,c))),t=x.recurrentActivation.apply(P.add(v,be(C,h))),n=P.add(P.mul(t,a),P.mul(e,x.activation.apply(P.add(b,be(L,p))))),i=x.recurrentActivation.apply(P.add(w,be(A,d)))}else{var T=be(E,x.kernel.read());T=P.add(T,be(r,x.recurrentKernel.read())),x.useBias&&(T=Ie(T,x.bias.read()));var R=he(T,0,x.units),D=he(T,x.units,x.units),F=he(T,2*x.units,x.units),O=he(T,3*x.units,x.units);e=x.recurrentActivation.apply(R),t=x.recurrentActivation.apply(D),n=P.add(P.mul(t,a),P.mul(e,x.activation.apply(F))),i=x.recurrentActivation.apply(O)}var M=P.mul(i,x.activation.apply(n));return[M,M,n]})},e.prototype.getConfig=function(){var e={units:this.units,activation:wn(this.activation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),recurrentInitializer:on(this.recurrentInitializer),biasInitializer:on(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Rn(this.kernelRegularizer),recurrentRegularizer:Rn(this.recurrentRegularizer),biasRegularizer:Rn(this.biasRegularizer),activityRegularizer:Rn(this.activityRegularizer),kernelConstraint:Oe(this.kernelConstraint),recurrentConstraint:Oe(this.recurrentConstraint),biasConstraint:Oe(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="LSTMCell",e}(Ni);P.serialization.SerializationMap.register(Ti);var Ri=function(o){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ti(e),o.call(this,e)||this}return l(e,o),e.prototype.call=function(i,r){var a=this;return P.tidy(function(){var e=null==r?null:r.mask,t=null==r?null:r.training,n=null==r?null:r.initialState;return o.prototype.call.call(a,i,{mask:e,training:t,initialState:n})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:wn(this.activation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),recurrentInitializer:on(this.recurrentInitializer),biasInitializer:on(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Rn(this.kernelRegularizer),recurrentRegularizer:Rn(this.recurrentRegularizer),biasRegularizer:Rn(this.biasRegularizer),activityRegularizer:Rn(this.activityRegularizer),kernelConstraint:Oe(this.kernelConstraint),recurrentConstraint:Oe(this.recurrentConstraint),biasConstraint:Oe(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=o.prototype.getConfig.call(this);return delete t.cell,Object.assign(e,t),e},e.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},e.className="LSTM",e}(Si);P.serialization.SerializationMap.register(Ri);var Di=function(o){function e(e){var t=o.call(this,e)||this;return t.cells=e.cells,t}return l(e,o),Object.defineProperty(e.prototype,"stateSize",{get:function(){for(var e=[],t=0,n=this.cells.slice().reverse();t<n.length;t++){var i=n[t];Array.isArray(i.stateSize)?e.push.apply(e,i.stateSize):e.push(i.stateSize)}return e},enumerable:!0,configurable:!0}),e.prototype.call=function(h,p){var d=this;return P.tidy(function(){for(var e=(h=h).slice(1),t=[],n=0,i=d.cells.slice().reverse();n<i.length;n++){var r=i[n];Array.isArray(r.stateSize)?t.push(e.splice(0,r.stateSize.length)):t.push(e.splice(0,1))}t.reverse();for(var a,o=[],s=0;s<d.cells.length;++s){r=d.cells[s];e=t[s],a=0===s?[h[0]].concat(e):[a[0]].concat(e),a=r.call(a,p),o.push(a.slice(1))}e=[];for(var l=0,u=o.slice().reverse();l<u.length;l++){var c=u[l];e.push.apply(e,c)}return[a[0]].concat(e)})},e.prototype.build=function(e){var t;c(e)&&(e=e[0]),e=e;for(var n=0,i=this.cells;n<i.length;n++){var r=i[n];r.build(e),t=Array.isArray(r.stateSize)?r.stateSize[0]:r.stateSize,e=[e[0],t]}this.built=!0},e.prototype.getConfig=function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var i=n[t];e.push({className:this.getClassName(),config:i.getConfig()})}var r={cells:e},a=o.prototype.getConfig.call(this);return Object.assign(r,a),r},e.fromConfig=function(e,t,n){void 0===n&&(n={});for(var i=[],r=0,a=t.cells;r<a.length;r++){var o=a[r];i.push(xe(o,n))}return new e({cells:i})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var e=[],t=0,n=this.cells;t<n.length;t++){var i=n[t];e.push.apply(e,i.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var i=n[t];e.push.apply(e,i.nonTrainableWeights)}if(!this.trainable){for(var r=[],a=0,o=this.cells;a<o.length;a++){i=o[a];r.push.apply(r,i.trainableWeights)}return r.concat(e)}return e},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var i=n[t];e.push.apply(e,i.weights)}return G(e)},e.prototype.setWeights=function(e){for(var t=[],n=0,i=this.cells;n<i.length;n++)for(var r=i[n],a=r.weights.length,o=e.splice(a),s=0;s<r.weights.length;++s)t.push([r.weights[s],o[s]]);J(t)},e.className="StackedRNNCells",e}(Ni);P.serialization.SerializationMap.register(Di);var Fi=function(n){function e(e){var t=n.call(this,e)||this;return t.layer=e.layer,t}return l(e,n),e.prototype.build=function(e){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(e){this.layer.setWeights(e)},e.prototype.getConfig=function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.fromConfig=function(e,t,n){void 0===n&&(n={});var i=xe(t.layer,n);delete t.layer;var r={layer:i};return Object.assign(r,t),new e(r)},e}(We),Oi=function(n){function e(e){var t=n.call(this,e)||this;return t.supportsMasking=!0,t}return l(e,n),e.prototype.build=function(e){if((e=h(e)).length<3)throw new oe("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),n.prototype.build.call(this,e)},e.prototype.computeOutputShape=function(e){var t=[(e=h(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),i=e[1];return[n[0],i].concat(n.slice(1))},e.prototype.call=function(e,n){var i=this;return P.tidy(function(){return Ii(function(e,t){return[i.layer.call(e,n),[]]},e=v(e),[],!1,null,null,!1,e.shape[1])[1]})},e.className="TimeDistributed",e}(Fi);P.serialization.SerializationMap.register(Oi);var Mi=["sum","mul","concat","ave"];var Ei=function(r){function e(e){var t,n=r.call(this,e)||this,i=e.layer.getConfig();if(n.forwardLayer=xe({className:e.layer.getClassName(),config:i}),i.goBackwards=!0!==i.goBackwards,n.backwardLayer=xe({className:e.layer.getClassName(),config:i}),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,t=e.mergeMode,p(Mi,"BidirectionalMergeMode",t),n.mergeMode=e.mergeMode,e.weights)throw new _("weights support is not implemented for Bidirectional layer yet.");return n._stateful=e.layer.stateful,n.returnSequences=e.layer.returnSequences,n.returnState=e.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=e.layer.inputSpec,n}return l(e,r),Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))},e.prototype.computeOutputShape=function(e){var t,n,i,r=this.forwardLayer.computeOutputShape(e);return Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r,this.returnState&&(i=r.slice(1)),t=t=r[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(i).concat(i.slice()):[t].concat(i).concat(i.slice()):L(n)},e.prototype.apply=function(e,t){var n=null;if(null!=t&&(n=t.initialState),Array.isArray(e)&&(n=e.slice(1),e=e[0]),null==n||0===n.length)return r.prototype.apply.call(this,e,t);throw new _("The support for initial states is not implemented for Bidirectional layers yet.")},e.prototype.call=function(r,a){var o=this;return P.tidy(function(){if(null!=a.mask)throw new _("The support for masking is not implemented for Bidirectional layers yet.");if(null!=a.initialState)throw new _("The support for initial states is not implemented for Bidirectional layers yet.");var e,t,n=o.forwardLayer.call(r,a),i=o.backwardLayer.call(r,a);return o.returnState&&(Array.isArray(n)&&(e=n.slice(1).concat(i.slice(1))),n=n[0],i=i[0]),o.returnSequences&&(i=P.reverse(i,1)),"concat"===o.mergeMode?t=de([n,i]):"sum"===o.mergeMode?t=P.add(n,i):"ave"===o.mergeMode?t=me(Y(.5),P.add(n,i)):"mul"===o.mergeMode?t=P.mul(n,i):null==o.mergeMode&&(t=[n,i]),o.returnState?null==o.mergeMode?t.concat(e):[t].concat(e):t})},e.prototype.resetStates=function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(e){var t=this;Se(this.forwardLayer.name,function(){t.forwardLayer.build(e)}),Se(this.backwardLayer.name,function(){t.backwardLayer.build(e)}),this.built=!0},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={mergeMode:this.mergeMode},t=r.prototype.getConfig.call(this);return Object.assign(e,t),e},e.fromConfig=function(e,t){var n=xe(t.layer);if(delete t.layer,null!=t.numConstants)throw new _("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var i=t;return i.layer=n,new e(i)},e.className="Bidirectional",e}(Fi);function xi(n){return f(this,void 0,void 0,function(){var t;return C(this,function(e){if("string"==typeof n){if(0===(t=P.io.getLoadHandlers(n)).length)t.push(P.io.browserHTTPRequest(n));else if(1<t.length)throw new oe("Found more than one ("+t.length+") load handlers for URL '"+n+"'");n=t[0]}return[2,function(r,a){return f(this,void 0,void 0,function(){var t,n,i;return C(this,function(e){switch(e.label){case 0:if(null==r.load)throw new oe("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,r.load()];case 1:if(t=e.sent(),null!=(n=t.modelTopology).model_config&&(n=n.model_config),i=xe(function e(t,n){if(null===t)return null;if("string"==typeof t)return g(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var i=[],r=t.length,a=0;a<r;++a){var o=t[a];Pe(n,a,o)?i.push(o):i.push(e(o,n))}return i}for(var s={},l=0,u=Object.keys(t);l<u.length;l++){var c=u[l],h=t[c];if("name"===c&&"string"==typeof h)s[c]=h;else{var p=g(c);s[p]=e(h,p)}}return s}(n),a),null!=t.weightData){if(null==t.weightSpecs)throw new oe("Model artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");!!1,i.loadWeights(P.io.decodeWeights(t.weightData,t.weightSpecs),!1,!0)}return[2,i]}})})}(n)]})})}P.serialization.SerializationMap.register(Ei);var Pi=function(a){function e(e){var t=a.call(this,{inputs:[],outputs:[]})||this;if(e=e||{},t.trainable=!0,t._updatable=!0,t.built=!1,t.name=null!=e.name?e.name:ke("sequential_"),null!=e.layers)for(var n=0,i=e.layers;n<i.length;n++){var r=i[n];t.add(r)}return t}return l(e,a),(o=e).prototype.add=function(e){var t,n=e instanceof o||e instanceof Ut;if(n){if(1!==(t=e).outputs.length)throw new oe("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new oe("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new oe("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=qe({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(n)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new oe("A layer added to a Sequential model must not already be connected somewhere else. Model received layer "+e.name+" which has "+e.inboundNodes.length+" pre-existing inbound connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new oe("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=function e(t,n,i){if((null==n||null!=i&&0<i)&&(n=t.sourceLayer,i=t.nodeIndex),0===n.inboundNodes.length)return[t];var r=n.inboundNodes[i];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],o=0;o<r.inboundLayers.length;o++)for(var s=0,l=e(r.inputTensors[o],r.inboundLayers[o],r.nodeIndices[o]);s<l.length;s++){var u=l[s];-1===a.indexOf(u)&&a.push(u)}return a}(this.outputs[0])}new Ue({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:M(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(e){return e.shape}),outputShapes:this.outputs[0].shape})}else{var r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1},e.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(e,t){return null==this.model&&this.build(),this.model.call(e,t)},e.prototype.build=function(e){if(h(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Ut({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.model.updatable=this.updatable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.setWeights=function(e){null==this.model&&this.build(),this.model.setWeights(e)},Object.defineProperty(e.prototype,"updatable",{get:function(){return this._updatable},set:function(e){this.built&&(this.model.updatable=e),this._updatable=e},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(e,t,n){if(void 0===n&&(n={}),!this.built)throw new ae("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)},e.prototype.predict=function(e,t){return void 0===t&&(t={}),null==this.model&&this.build(),this.model.predict(e,t)},e.prototype.predictOnBatch=function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)},e.prototype.compile=function(e){this.build(),this.model.compile(e),this.optimizer=this.model.optimizer,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},e.prototype.fit=function(t,n,i){return void 0===i&&(i={}),f(this,void 0,void 0,function(){return C(this,function(e){if(!this.built)throw new ae("The model needs to be compiled before being used.");return[2,this.model.fit(t,n,i)]})})},e.fromConfig=function(e,t){var n=new e({});if(!(n instanceof o))throw new oe("Sequential.fromConfig called on non-Sequential input: "+n);if(!(t instanceof Array))throw new oe("Sequential.fromConfig called without an array of configs");if(null==t[0].className||"Merge"===t[0].className)throw new oe("Legacy serialization format not supported yet.");for(var i=0,r=t;i<r.length;i++){var a=xe(r[i]);n.add(a)}return n},e.prototype.getConfig=function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var i=n[t];e.push({className:i.getClassName(),config:i.getConfig()})}return e},e.className="Sequential",n([P.doc({heading:"Models",subheading:"Classes"})],e.prototype,"add",null),n([P.doc({heading:"Models",subheading:"Classes",configParamIndices:[2]})],e.prototype,"evaluate",null),n([P.doc({heading:"Models",subheading:"Classes",configParamIndices:[1]})],e.prototype,"predict",null),n([P.doc({heading:"Models",subheading:"Classes",configParamIndices:[2]})],e.prototype,"fit",null),e=o=n([P.doc({heading:"Models",subheading:"Classes"})],e);var o}(Ut);P.serialization.SerializationMap.register(Pi);var _i=function(){function e(){}return e.model=function(e){return new Ut(e)},e.sequential=function(e){return new Pi(e)},e.loadModel=function(e){return xi(e)},e.input=function(e){return qe(e)},n([P.doc({heading:"Models",subheading:"Creation",configParamIndices:[0]})],e,"model",null),n([P.doc({heading:"Models",subheading:"Creation",configParamIndices:[0]})],e,"sequential",null),n([P.doc({heading:"Models",subheading:"Loading",useDocsFrom:"loadModelInternal"})],e,"loadModel",null),n([P.doc({heading:"Models",subheading:"Inputs",useDocsFrom:"Input",configParamIndices:[0]})],e,"input",null),e}(),Bi=function(){function t(){}return t.inputLayer=function(e){return new Ve(e)},t.elu=function(e){return new Nn(e)},t.leakyReLU=function(e){return new Sn(e)},t.softmax=function(e){return new Cn(e)},t.thresholdedReLU=function(e){return new kn(e)},t.conv1d=function(e){return new jn(e)},t.conv2d=function(e){return new _n(e)},t.conv2dTranspose=function(e){return new Bn(e)},t.separableConv2d=function(e){return new Un(e)},t.cropping2D=function(e){return new Wn(e)},t.upSampling2d=function(e){return new Vn(e)},t.depthwiseConv2d=function(e){return new qn(e)},t.activation=function(e){return new Gn(e)},t.dense=function(e){return new Kn(e)},t.dropout=function(e){return new Zn(e)},t.flatten=function(e){return new Hn(e)},t.repeatVector=function(e){return new Jn(e)},t.reshape=function(e){return new Xn(e)},t.embedding=function(e){return new $n(e)},t.add=function(e){return new Qn(e)},t.average=function(e){return new ti(e)},t.concatenate=function(e){return new ri(e)},t.maximum=function(e){return new ni(e)},t.minimum=function(e){return new ii(e)},t.multiply=function(e){return new ei(e)},t.batchNormalization=function(e){return new si(e)},t.zeroPadding2d=function(e){return new li(e)},t.averagePooling1d=function(e){return new pi(e)},t.avgPool1d=function(e){return t.averagePooling1d(e)},t.avgPooling1d=function(e){return t.averagePooling1d(e)},t.averagePooling2d=function(e){return new gi(e)},t.avgPool2d=function(e){return t.averagePooling2d(e)},t.avgPooling2d=function(e){return t.averagePooling2d(e)},t.globalAveragePooling1d=function(e){return new yi(e)},t.globalAveragePooling2d=function(e){return new wi(e)},t.globalMaxPooling1d=function(e){return new vi(e)},t.globalMaxPooling2d=function(e){return new zi(e)},t.maxPooling1d=function(e){return new hi(e)},t.maxPooling2d=function(e){return new fi(e)},t.gru=function(e){return new Ai(e)},t.gruCell=function(e){return new Li(e)},t.lstm=function(e){return new Ri(e)},t.lstmCell=function(e){return new Ti(e)},t.simpleRNN=function(e){return new Ci(e)},t.simpleRNNCell=function(e){return new ki(e)},t.rnn=function(e){return new Si(e)},t.stackedRNNCells=function(e){return new Di(e)},t.bidirectional=function(e){return new Ei(e)},t.timeDistributed=function(e){return new Oi(e)},t.Layer=We,t.RNN=Si,t.RNNCell=Ni,t.input=_i.input,n([P.doc({heading:"Layers",subheading:"Inputs",namespace:"layers",useDocsFrom:"InputLayer",configParamIndices:[0]})],t,"inputLayer",null),n([P.doc({heading:"Layers",subheading:"Advanced Activation",namespace:"layers",useDocsFrom:"ELU",configParamIndices:[0]})],t,"elu",null),n([P.doc({heading:"Layers",subheading:"Advanced Activation",namespace:"layers",useDocsFrom:"LeakyReLU",configParamIndices:[0]})],t,"leakyReLU",null),n([P.doc({heading:"Layers",subheading:"Advanced Activation",namespace:"layers",useDocsFrom:"Softmax",configParamIndices:[0]})],t,"softmax",null),n([P.doc({heading:"Layers",subheading:"Advanced Activation",namespace:"layers",useDocsFrom:"ThresholdedReLU",configParamIndices:[0]})],t,"thresholdedReLU",null),n([P.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"Conv1D",configParamIndices:[0]})],t,"conv1d",null),n([P.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"Conv2D",configParamIndices:[0]})],t,"conv2d",null),n([P.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"Conv2DTranspose",configParamIndices:[0]})],t,"conv2dTranspose",null),n([P.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"SeparableConv2D",configParamIndices:[0]})],t,"separableConv2d",null),n([P.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"Cropping2D",configParamIndices:[0]})],t,"cropping2D",null),n([P.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"UpSampling2D",configParamIndices:[0]})],t,"upSampling2d",null),n([P.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"DepthwiseConv2D",configParamIndices:[0]})],t,"depthwiseConv2d",null),n([P.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Activation",configParamIndices:[0]})],t,"activation",null),n([P.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Dense",configParamIndices:[0]})],t,"dense",null),n([P.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Dropout",configParamIndices:[0]})],t,"dropout",null),n([P.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Flatten",configParamIndices:[0]})],t,"flatten",null),n([P.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"RepeatVector",configParamIndices:[0]})],t,"repeatVector",null),n([P.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Reshape",configParamIndices:[0]})],t,"reshape",null),n([P.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Embedding",configParamIndices:[0]})],t,"embedding",null),n([P.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Add",configParamIndices:[0]})],t,"add",null),n([P.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Average",configParamIndices:[0]})],t,"average",null),n([P.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Concatenate",configParamIndices:[0]})],t,"concatenate",null),n([P.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Maximum",configParamIndices:[0]})],t,"maximum",null),n([P.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Minimum",configParamIndices:[0]})],t,"minimum",null),n([P.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Multiply",configParamIndices:[0]})],t,"multiply",null),n([P.doc({heading:"Layers",subheading:"Normalization",namespace:"layers",useDocsFrom:"BatchNormalization",configParamIndices:[0]})],t,"batchNormalization",null),n([P.doc({heading:"Layers",subheading:"Padding",namespace:"layers",useDocsFrom:"ZeroPadding2D",configParamIndices:[0]})],t,"zeroPadding2d",null),n([P.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"AveragePooling1D",configParamIndices:[0]})],t,"averagePooling1d",null),n([P.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"AveragePooling2D",configParamIndices:[0]})],t,"averagePooling2d",null),n([P.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"GlobalAveragePooling1D",configParamIndices:[0]})],t,"globalAveragePooling1d",null),n([P.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"GlobalAveragePooling2D",configParamIndices:[0]})],t,"globalAveragePooling2d",null),n([P.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"GlobalMaxPooling1D",configParamIndices:[0]})],t,"globalMaxPooling1d",null),n([P.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"GlobalMaxPooling2D",configParamIndices:[0]})],t,"globalMaxPooling2d",null),n([P.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"MaxPooling1D",configParamIndices:[0]})],t,"maxPooling1d",null),n([P.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"MaxPooling2D",configParamIndices:[0]})],t,"maxPooling2d",null),n([P.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"GRU",configParamIndices:[0]})],t,"gru",null),n([P.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"GRUCell",configParamIndices:[0]})],t,"gruCell",null),n([P.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"LSTM",configParamIndices:[0]})],t,"lstm",null),n([P.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"LSTMCell",configParamIndices:[0]})],t,"lstmCell",null),n([P.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"SimpleRNN",configParamIndices:[0]})],t,"simpleRNN",null),n([P.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"SimpleRNNCell",configParamIndices:[0]})],t,"simpleRNNCell",null),n([P.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"RNN",configParamIndices:[0]})],t,"rnn",null),n([P.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"RNN",configParamIndices:[0]})],t,"stackedRNNCells",null),n([P.doc({heading:"Layers",subheading:"Wrapper",namespace:"layers",useDocsFrom:"Bidirectional",configParamIndices:[0]})],t,"bidirectional",null),n([P.doc({heading:"Layers",subheading:"Wrapper",namespace:"layers",useDocsFrom:"TimeDistributed",configParamIndices:[0]})],t,"timeDistributed",null),t}(),Ui=function(){function e(){}return e.maxNorm=function(e){return new Ae(e)},e.unitNorm=function(e){return new Te(e)},e.nonNeg=function(){return new Re},e.minMaxNorm=function(e){return new De(e)},n([P.doc({heading:"Constraints",namespace:"constraints",useDocsFrom:"MaxNorm",configParamIndices:[0]})],e,"maxNorm",null),n([P.doc({heading:"Constraints",namespace:"constraints",useDocsFrom:"UnitNorm",configParamIndices:[0]})],e,"unitNorm",null),n([P.doc({heading:"Constraints",namespace:"constraints",useDocsFrom:"NonNeg"})],e,"nonNeg",null),n([P.doc({heading:"Constraints",namespace:"constraints",useDocsFrom:"MinMaxNormConfig",configParamIndices:[0]})],e,"minMaxNorm",null),e}(),ji=function(){function e(){}return e.zeros=function(){return new qt},e.ones=function(){return new Zt},e.constant=function(e){return new Kt(e)},e.randomUniform=function(e){return new Ht(e)},e.randomNormal=function(e){return new Gt(e)},e.truncatedNormal=function(e){return new Jt(e)},e.identity=function(e){return new Xt(e)},e.varianceScaling=function(e){return new $t(e)},e.glorotUniform=function(e){return new Yt(e)},e.glorotNormal=function(e){return new Qt(e)},e.heNormal=function(e){return new en(e)},e.leCunNormal=function(e){return new tn(e)},e.orthogonal=function(e){return new nn(e)},n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"Zeros"})],e,"zeros",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"Ones"})],e,"ones",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"Constant",configParamIndices:[0]})],e,"constant",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"RandomUniform",configParamIndices:[0]})],e,"randomUniform",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"RandomNormal",configParamIndices:[0]})],e,"randomNormal",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"TruncatedNormal",configParamIndices:[0]})],e,"truncatedNormal",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"Identity",configParamIndices:[0]})],e,"identity",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"VarianceScaling",configParamIndices:[0]})],e,"varianceScaling",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"GlorotUniform",configParamIndices:[0]})],e,"glorotUniform",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"GlorotNormal",configParamIndices:[0]})],e,"glorotNormal",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"HeNormal",configParamIndices:[0]})],e,"heNormal",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"LeCunNormal",configParamIndices:[0]})],e,"leCunNormal",null),n([P.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"Orthogonal",configParamIndices:[0]})],e,"orthogonal",null),e}(),Wi=function(){function e(){}return e.binaryAccuracy=function(e,t){return gt(e,t)},e.binaryCrossentropy=function(e,t){return yt(e,t)},e.categoricalAccuracy=function(e,t){return mt(e,t)},e.categoricalCrossentropy=function(e,t){return lt(e,t)},e.cosineProximity=function(e,t){return dt(e,t)},e.prototype.meanAbsoluteError=function(e,t){return tt(e,t)},e.prototype.meanAbsolutePercentageError=function(e,t){return nt(e,t)},e.prototype.MAPE=function(e,t){return nt(e,t)},e.prototype.mape=function(e,t){return nt(e,t)},e.meanSquaredError=function(e,t){return et(e,t)},e.MSE=function(e,t){return et(e,t)},e.mse=function(e,t){return et(e,t)},n([P.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"meanAbsoluteError"})],e.prototype,"meanAbsoluteError",null),n([P.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"meanAbsolutePercentageError"})],e.prototype,"meanAbsolutePercentageError",null),n([P.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"binaryAccuracy"})],e,"binaryAccuracy",null),n([P.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"binaryCrossentropy"})],e,"binaryCrossentropy",null),n([P.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"categoricalAccuracy"})],e,"categoricalAccuracy",null),n([P.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"categoricalCrossentropy"})],e,"categoricalCrossentropy",null),n([P.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"cosineProximity"})],e,"cosineProximity",null),n([P.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"meanSquaredError"})],e,"meanSquaredError",null),e}(),Vi=function(){function e(){}return e.l1l2=function(e){return new An(e)},e.l1=function(e){return new An({l1:null!=(t=e)?t.l1:null,l2:0});var t},e.l2=function(e){return new An({l2:null!=(t=e)?t.l2:null,l1:0});var t},n([P.doc({heading:"Regularizers",namespace:"regularizers",useDocsFrom:"L1L2",configParamIndices:[0]})],e,"l1l2",null),n([P.doc({heading:"Regularizers",namespace:"regularizers",useDocsFrom:"L1L2",configParamIndices:[0]})],e,"l1",null),n([P.doc({heading:"Regularizers",namespace:"regularizers",useDocsFrom:"L1L2",configParamIndices:[0]})],e,"l2",null),e}(),qi=_i.model,Zi=_i.sequential,Ki=_i.loadModel,Hi=_i.input,Gi=Bi,Ji=Ui,Xi=ji,$i=Wi,Yi=Vi;e.model=qi,e.sequential=Zi,e.loadModel=Ki,e.input=Hi,e.layers=Gi,e.constraints=Ji,e.initializers=Xi,e.metrics=$i,e.regularizers=Yi,e.Callback=He,e.CallbackList=Ge,e.CustomCallback=Ye,e.Model=Ut,e.RNN=Si,e.Sequential=Pi,e.SymbolicTensor=Z,e.version_layers="0.6.6",Object.defineProperty(e,"__esModule",{value:!0})});
